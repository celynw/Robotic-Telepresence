<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Extending rosserial size | Robotic Telepresence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="The rosbag I have access to contains octomap messages.Using rosbag info, it has 55 messages. Echoing the first one shows it contains 83860 bytes.The maximum I’ve been able to get using rosserial is 11">
<meta property="og:type" content="article">
<meta property="og:title" content="Extending rosserial size">
<meta property="og:url" content="https://celynwalters.github.io/Robotic-Telepresence/2017/03/17/Examining-octomap-messages/index.html">
<meta property="og:site_name" content="Robotic Telepresence">
<meta property="og:description" content="The rosbag I have access to contains octomap messages.Using rosbag info, it has 55 messages. Echoing the first one shows it contains 83860 bytes.The maximum I’ve been able to get using rosserial is 11">
<meta property="og:updated_time" content="2017-03-20T13:26:46.008Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Extending rosserial size">
<meta name="twitter:description" content="The rosbag I have access to contains octomap messages.Using rosbag info, it has 55 messages. Echoing the first one shows it contains 83860 bytes.The maximum I’ve been able to get using rosserial is 11">
  
    <link rel="alternate" href="/atom.xml" title="Robotic Telepresence" type="application/atom+xml">
  
  
    <link rel="icon" href="/Robotic-Telepresence/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/Robotic-Telepresence/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-87037949-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/Robotic-Telepresence/" id="logo">Robotic Telepresence</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/Robotic-Telepresence/" id="subtitle">Electronic Engineering BEng final project</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/Robotic-Telepresence/">Home</a>
        
          <a class="main-nav-link" href="/Robotic-Telepresence/Project-objectives">Project Objectives</a>
        
          <a class="main-nav-link" href="https://www.teamgantt.com/gantt/schedule/?ids=702976&public_keys=1UNWW0SIdEwg&zoom=w90&font_size=12&estimated_hours=0&assigned_resources=0&percent_complete=0&documents=0&comments=0&col_width=255&menu_view=0&resource_filter=1&name_in_bar=0&name_next_to_bar=0&resource_names=1">Gantt Chart</a>
        
          <a class="main-nav-link" href="/Robotic-Telepresence/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://celynwalters.github.io/Robotic-Telepresence"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Examining-octomap-messages" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Extending rosserial size
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/03/17/Examining-octomap-messages/" class="article-date">
  <time datetime="2017-03-17T11:05:47.000Z" itemprop="datePublished">Fri 17/03/2017 12:05</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>The <code>rosbag</code> I have access to contains octomap messages.<br>Using <code>rosbag info</code>, it has 55 messages. Echoing the first one shows it contains 83860 bytes.<br>The maximum I’ve been able to get using <code>rosserial</code> is 1177, although I’d expect it to be 65536.</p>
<p>Managed to get it up to 2221 points by increasing <code>INPUT_SIZE</code> and <code>OUTPUT_SIZE</code> from 512 to 1024<br>(Repeatable):<br>1776 using 512<br>    3.46875<br>2221 using 1024<br>    2.1689453125<br>4065 using 2048<br>    1.98486328125<br>        31<br>65468 using 65536<br>    0.99896240234375<br>        68</p>
<p>Need 9830400 every 0.1 seconds…<br>1500 Hz at this throughput!</p>
<p>An interesting development.<br>When publishing only just over the maximum buffer, <code>rosserial_server</code> exits without hanging:<br><figure class="highlight bash"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">terminate called after throwing an instance of <span class="string">'ros::serialization::StreamOverrunException'</span></div><div class="line">  what():  Buffer Overrun</div><div class="line">Aborted (core dumped)</div></pre></td></tr></table></figure></p>
<p>This time, the limit is ROS in linux.<br>It’s not a compatibility issue between different versions of <code>rosserial_server</code> and <code>rosserial_windows</code> (tested it).</p>
<figure class="highlight bash"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p ~/catkin_ws/src</div><div class="line">$ <span class="built_in">cd</span> !$</div><div class="line">$ catkin_init_workspace</div><div class="line">$ <span class="built_in">cd</span> src/</div><div class="line">$ git <span class="built_in">clone</span> -b indigo-devel https://github.com/ros-drivers/rosserial.git</div><div class="line">$ <span class="built_in">cd</span> ../</div><div class="line">$ catkin_make</div></pre></td></tr></table></figure>
<p>Sending 1000x largest clouds at 100Hz.<br><code>rostopic echo</code> is as expected, takes 10 seconds.<br>Windows subscriber stops at 751, takes<br>    7.499 to 37.415 = 29.916 seconds<br>    3.666 to 32.948 = 29.282</p>
<p>Decreasing wait in spin() loop to 1ms from 5ms<br>Did 852 this time!<br>    3.733 to 30.648 = 26.915 seconds</p>
<p>Switching to Release in Visual Stuio causes <code>rosserial_server</code> to complain:<br><figure class="highlight bash"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[ERROR] [1489763341.521603888]: Buffer overrun when attempting to parse setup message.</div><div class="line">[ERROR] [1489763341.521666993]: Is this firmware from a pre-Groovy rosserial?</div><div class="line">[ERROR] [1489763341.521753826]: Buffer overrun when attempting to parse setup message.</div></pre></td></tr></table></figure></p>
<p>95.63% of the CPU used was in <code>WindowsSocket::read</code>.</p>
<p>Multi-threaded spinning?! Yes please.<br><a href="http://wiki.ros.org/roscpp/Overview/Callbacks%20and%20Spinning#Multi-threaded_Spinning" target="_blank" rel="external">http://wiki.ros.org/roscpp/Overview/Callbacks%20and%20Spinning#Multi-threaded_Spinning</a></p>
<p>It’s not a part of <code>rosserial_windows</code>…<br>There’s a <code>roscpp</code> folder but there’s not much in there.</p>
<p>Mashed!</p>
<ul>
<li><a href="https://github.com/ros/ros_comm" target="_blank" rel="external">https://github.com/ros/ros_comm</a></li>
<li><a href="https://github.com/ros/roscpp_core" target="_blank" rel="external">https://github.com/ros/roscpp_core</a></li>
</ul>
<p>WallTime and WallDuration replace with Time and Duration respectively.<br>Build succeeded! WOW.<br>No. No.</p>
<p>16th of optimised point cloud = 19200<br>25.5Hz at max data size (65468), limited by CPU though (single core).<br>87Hz max like this (my CPU). Ok.</p>
<p><a href="https://www.phoronix.com/scan.php?page=article&amp;item=steamvr-linux-beta&amp;num=4" target="_blank" rel="external">https://www.phoronix.com/scan.php?page=article&amp;item=steamvr-linux-beta&amp;num=4</a></p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/03/17/Examining-octomap-messages/" data-id="cj0i5jeam000ays9ra1gx70wg" class="article-share-link">Share</a>
    
     
  </footer>
  
    
<nav id="article-nav">
  
  
    <a href="/Robotic-Telepresence/2017/03/17/Extending-rosserial-size/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Extending rosserial size</div>
    </a>
  
</nav>

  
</article>


</section>
        <!-- MANUALLY ADDED FOR GANTT CHART -->
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2017/02/">February 2017</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2016/12/">December 2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2016/11/">November 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2016/10/">October 2016</a><span class="archive-list-count">14</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Celyn Walters<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/Robotic-Telepresence/" class="mobile-nav-link">Home</a>
  
    <a href="/Robotic-Telepresence/Project-objectives" class="mobile-nav-link">Project Objectives</a>
  
    <a href="https://www.teamgantt.com/gantt/schedule/?ids=702976&public_keys=1UNWW0SIdEwg&zoom=w90&font_size=12&estimated_hours=0&assigned_resources=0&percent_complete=0&documents=0&comments=0&col_width=255&menu_view=0&resource_filter=1&name_in_bar=0&name_next_to_bar=0&resource_names=1" class="mobile-nav-link">Gantt Chart</a>
  
    <a href="/Robotic-Telepresence/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/Robotic-Telepresence/fancybox/jquery.fancybox.css">
  <script src="/Robotic-Telepresence/fancybox/jquery.fancybox.pack.js"></script>


<script src="/Robotic-Telepresence/js/script.js"></script>

  </div>
</body>
</html>
