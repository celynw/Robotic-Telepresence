<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Robotic Telepresence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Robotic Telepresence">
<meta property="og:url" content="https://celynwalters.github.io/Robotic-Telepresence/index.html">
<meta property="og:site_name" content="Robotic Telepresence">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Robotic Telepresence">
  
    <link rel="alternate" href="/atom.xml" title="Robotic Telepresence" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/Robotic-Telepresence/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-87037949-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/Robotic-Telepresence/" id="logo">Robotic Telepresence</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/Robotic-Telepresence/" id="subtitle">Year 3 project notes/blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/Robotic-Telepresence/">Home</a>
        
          <a class="main-nav-link" href="/Robotic-Telepresence/Project-objectives">Project Objectives</a>
        
          <a class="main-nav-link" href="https://www.teamgantt.com/gantt/schedule/?ids=702976&public_keys=1UNWW0SIdEwg&zoom=w90&font_size=12&estimated_hours=0&assigned_resources=0&percent_complete=0&documents=0&comments=0&col_width=255&menu_view=0&resource_filter=1&name_in_bar=0&name_next_to_bar=0&resource_names=1">Gantt Chart</a>
        
          <a class="main-nav-link" href="/Robotic-Telepresence/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://celynwalters.github.io/Robotic-Telepresence"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Project-meeting-11" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/23/Project-meeting-11/">Project meeting 11</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/23/Project-meeting-11/" class="article-date">
  <time datetime="2017-02-23T23:27:07.000Z" itemprop="datePublished">Thu 23/02/2017 23:27</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>The focus of the meeting was the midterm report.<br>Main points which came up were:</p>
<ul>
<li>I put content in the abstract which, if anywhere, should have been in the introduction</li>
<li>I should always have text between subsequent headings/subheadings</li>
<li>I shouldn’t often go below X.X subsections. Most of the writing was in X.X.X.</li>
<li>I need to make things extremely clear<ul>
<li>My aim</li>
<li>My objectives</li>
<li>The work I’ve done</li>
</ul>
</li>
<li>I fell into the chronological order trap. I should structure it from broad to more specific</li>
<li>The same goes for supporting diagrams</li>
</ul>
<p>I also need to come up with some ways to test the resulting applications.</p>
<ul>
<li>Qualitative results<ul>
<li>Screenshots</li>
<li>Video (viva)</li>
<li>Demonstration</li>
</ul>
</li>
<li>Quantitative results<ul>
<li>Numerical testing values<ul>
<li>Latency?</li>
<li>Throughput?</li>
<li>etc.<br>I can obtain some of these by doing user tests and asking them to complete a survey afterwards.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>With regards to the background literature, I’l need much more for the final report.<br>Report reviews are very helpful.<br><del>Steal</del> Reference the results they already have.</p>
<p>I’ll be using LaTeX to write the final thing.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/23/Project-meeting-11/" data-id="cizlhttb4000w509rg7r1xh1t" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Started-dissertation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/22/Started-dissertation/">Started dissertation</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/22/Started-dissertation/" class="article-date">
  <time datetime="2017-02-22T23:28:46.000Z" itemprop="datePublished">Wed 22/02/2017 23:28</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I am using <a href="https://www.sharelatex.com/" target="_blank" rel="external">ShareLaTeX</a>. The free features are great. I’m only missing git synchronisation, but I can still do it manually.<br>I found the <a href="https://github.com/themasterchef/computing-project-report-template" target="_blank" rel="external">Computer Science department’s template</a> which I can modify to suit my course.<br>By the next project meeting I will have a preliminary structure.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/22/Started-dissertation/" data-id="cizlhttbi001c509r30svwr8j" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Live-depth-data-in-Unity" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/22/Live-depth-data-in-Unity/">Live depth data in Unity</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/22/Live-depth-data-in-Unity/" class="article-date">
  <time datetime="2017-02-22T16:27:47.000Z" itemprop="datePublished">Wed 22/02/2017 16:27</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Due to the way Unity scripts work, many features in Visual Studio which are usually present are not available.<br>I wasn’t able to use <code>using Microsoft.Kinect</code>, change the references, or change project properties.<br>My only option was to keep it as a separate application or modify some existing code.<br>Since I already have external applications, it was preferable to find the functionality in an existing asset.</p>
<p>The <a href="https://www.assetstore.unity3d.com/en/#!/content/7747" target="_blank" rel="external">Kinect with MS-SDK</a> plugin I found before, along with any others, seemed to focus more on calculating skeletal data.<br>This plugin was the most complete, and it had a demo which showed live depth data.</p>
<p>I hacked it apart, brutally removing anything which wasn’t necessary.<br>I still don’t have direct access to the data, and I’m not sure how difficult or intensive getting point cloud data will be.<br>The supporting code seems to have some direct communication to the Kinect, and I think I will be able to do things like decimate the data if it’s too many points.<br>It should be relatively similar to the Kinect v2 as well.<br><img src="/Robotic-Telepresence/2017/02/22/Live-depth-data-in-Unity/Depth Kinect.png" alt="Me at the desk"><br>TBC this week</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/22/Live-depth-data-in-Unity/" data-id="cizlhttao000h509rifwsgg4k" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Native-Windows-point-cloud" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/22/Native-Windows-point-cloud/">Native Windows point cloud</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/22/Native-Windows-point-cloud/" class="article-date">
  <time datetime="2017-02-22T00:21:18.000Z" itemprop="datePublished">Wed 22/02/2017 00:21</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Most existing Unity plugins or assets seem to be focused on calculating bone positions of humans.<br>In the robot lab, I was showed how the Kinect (v1) was interfaced with using WPF C#.<br>This is the model which recorded the point cloud for the <code>ROSbag</code>, although there are v2s around which are better.</p>
<p>I can either adapt a sample from within the <a href="https://www.microsoft.com/en-us/download/details.aspx?id=40276" target="_blank" rel="external">Kinect Developer Toolkit 1.8.0</a>, or adapt existing code already compatible with UnityScript, <a href="https://developer.microsoft.com/en-us/windows/kinect/tools" target="_blank" rel="external">Microsoft Unity Pro packages</a><br>I will still try to stream them over <code>rosserial_windows</code> as this is not turning out to be an easy sidestep of the problem.<br>Perhaps there is a way to decimate the point cloud which could solve the problem.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/22/Native-Windows-point-cloud/" data-id="cizlhttau000n509rpm49834m" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-VR-improvements" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/20/VR-improvements/">VR improvements</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/20/VR-improvements/" class="article-date">
  <time datetime="2017-02-20T17:55:29.000Z" itemprop="datePublished">Mon 20/02/2017 17:55</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h4 id="Hands"><a href="#Hands" class="headerlink" title="Hands"></a>Hands</h4><p>I’ve made it so that the correct-side gripper is drawn at the controller’s position when the trigger is pressed.<br>It’s translucent to signify a target, as well as having the green line to show the order between targets.<br>The controller models disappear when selecting a position so that it’s easier to see where to line the gripper up with.</p>
<p>I’ve also added text to display which hand is which, as well as diagrams to show which orientation we are in.</p>
<div class="video-container"><iframe src="//www.youtube.com/embed/Q-NrmlMVt88" frameborder="0" allowfullscreen></iframe></div>
<h4 id="Command-queue"><a href="#Command-queue" class="headerlink" title="Command queue"></a>Command queue</h4><p>I’m not sure how to mark these steps as ‘done’ so that they can be removed from the queue, but subsequent moves are queued for Baxter’s IK solver to crunch through.</p>
<h4 id="Still-need"><a href="#Still-need" class="headerlink" title="Still need"></a>Still need</h4><ul>
<li>The ability to cancel the last move</li>
<li>When swapping orientations, move the physical location of the user (fade through black?)</li>
</ul>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/20/VR-improvements/" data-id="cizlhttbj001e509rkhdnhi25" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-10" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/15/Project-meeting-10/">Project meeting 10</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/15/Project-meeting-10/" class="article-date">
  <time datetime="2017-02-15T16:28:45.000Z" itemprop="datePublished">Wed 15/02/2017 16:28</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I now have access to a PC in the robot lab.<br>It’s almost ready to go, I still need local network access so that ROS data can be communicated.<br>The first thing I want to try is the joint angles, but it would be great to get the point cloud data as well.<br>In the mean time, I’ll be looking into generating the commands for moving Baxter, and setting restrictions on movement from within the Unity project.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/15/Project-meeting-10/" data-id="cizlhttb2000t509rw59vr6bb" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Visualising-grippers" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/15/Visualising-grippers/">Visualising grippers</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/15/Visualising-grippers/" class="article-date">
  <time datetime="2017-02-15T11:24:14.000Z" itemprop="datePublished">Wed 15/02/2017 11:24</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>The meshes for the grippers were not previously present beacuse they are in a separate folder.<br>I’m going to be using the models to show the target position for the hands.<br>The way the grippers are included in the <code>URDF</code> description is by using variables within the <code>.urdf</code> file, such as <code>${side}</code>.<br>The reason for this is because gripper parts are used (reflected) for left and right, and for each arm. The grippers can be interchanged for different types as well.<br>My importer script does not handle variables, so at first it seemed simple enough to just manually enter their locations into Unity.<br>I recall that:</p>
<p>For position</p>
<blockquote>
<table>
<thead>
<tr>
<th>ROS</th>
<th>Unity</th>
</tr>
</thead>
<tbody>
<tr>
<td>X +ve</td>
<td>X -ve</td>
</tr>
<tr>
<td>Y +ve</td>
<td>Y +ve</td>
</tr>
<tr>
<td>Z +ve</td>
<td>Z +ve</td>
</tr>
</tbody>
</table>
</blockquote>
<p>For rotation:</p>
<blockquote>
<table>
<thead>
<tr>
<th>ROS</th>
<th>Unity</th>
</tr>
</thead>
<tbody>
<tr>
<td>X +ve</td>
<td>X +ve</td>
</tr>
<tr>
<td>Y +ve</td>
<td>Y -ve</td>
</tr>
<tr>
<td>Z +ve</td>
<td>Z -ve</td>
</tr>
</tbody>
</table>
<p>Must be performed in order: Z, Y, X</p>
</blockquote>
<p>I am using the “standard narrow” grippers for now.</p>
<p>I was running into problems with manually adding the grippers to the scene, there’s a lot of numbers in the wrong order and format.<br>It would be a reasonable task to edit my importer to support the extra files and conditional arguments in the new file.<br>The easiest thing to do was to merge the <code>.urdf</code> files into a single one manually, and then importing that.</p>
<p>Each link creates a joint, and each joint creates a link, recursively until the bottom of the hierarchy.<br>When creating a link, if it has a <code>visual/geometry/mesh</code> node, then the current link <code>GameObject</code> is destroyed, and replaced with the related mesh (which generates its own <code>GameObject</code>).<br>The list below shows how meshes in the <code>baxter_base</code> section import, and their components:</p>
<blockquote>
<ul>
<li>NAME<br>[Animator]<ul>
<li>Camera</li>
<li>NAME<br>[Mesh Filter]<br>[Mesh Renderer]</li>
<li>Lamp</li>
</ul>
</li>
</ul>
</blockquote>
<p>However, this is what the grippers import like:</p>
<blockquote>
<ul>
<li>NAME<br>[Animator]<br>[Mesh Filter]<br>[Mesh Renderer]</li>
</ul>
</blockquote>
<p>I’ve changed the importer to adapt.<br>I must have made some small mistakes, as I had to manually change the sign or axes of some values for the parts to be in their correct locations.</p>
<p>I had to replace some variables, such as <code>${-pi/2}</code> and <code>${finger_length}</code>.<br><code>${reflect}</code> is used as ±1.</p>
<p><img src="/Robotic-Telepresence/2017/02/15/Visualising-grippers/Result.png" alt="Using the standard narrow grippers for now, in slot 0"></p>
<p><img src="/Robotic-Telepresence/2017/02/15/Visualising-grippers/Photo.jpg" alt="A photo of Baxter&#39;s wrist stub showing the slots"></p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/15/Visualising-grippers/" data-id="cizlhttbv001g509rfrtl0bap" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Kinect-with-Unity" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/14/Kinect-with-Unity/">Kinect with Unity</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/14/Kinect-with-Unity/" class="article-date">
  <time datetime="2017-02-14T19:21:31.000Z" itemprop="datePublished">Tue 14/02/2017 19:21</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>To side-step the communication issues with <code>PointCloud2</code> for now, I’ll try to connect the Kinect directly to Unity and its host PC.<br><a href="https://www.youtube.com/watch?v=YLzMT_Epvpw" target="_blank" rel="external">This video</a> shows that moving point clouds are possible, but I’m not sure how out-of-the-box it will be.</p>
<p>The official Kinect SDK apparently uses .NET 4 rather than Unity’s .NET 2.<br>I installed version 1.7.<br>I also added the “<a href="https://www.assetstore.unity3d.com/en/#!/content/7747" target="_blank" rel="external">Kinect with MS-SDK</a>“ asset from the asset store.<br>It apparently includes a simulator for the Kinect, but it didn’t seem to do anything.<br>As with most other things I’ve found, it’s geared towards calculating skeletal data, but will hopefully allow access to the point clouds.<br>This applies to what I think was being referred to for Unreal, the “<a href="http://www.opaque.media/kinect-4-unreal/" target="_blank" rel="external">Kinect 4 Unreal</a>“ plugin by Opaque Media Group.<br>I’m pretty sure this isn’t compatible in any way.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/14/Kinect-with-Unity/" data-id="cizlhttam000f509r8uzwslfu" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-VR-feature-Angle-snapping" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/12/VR-feature-Angle-snapping/">VR feature: Angle snapping</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/12/VR-feature-Angle-snapping/" class="article-date">
  <time datetime="2017-02-12T17:59:33.000Z" itemprop="datePublished">Sun 12/02/2017 17:59</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I thought this would be an easy feature to add.<br>When drawing targets, holding the grip buttons would snap the new location to a 45-degree-quantised vector from the first position.</p>
<p>At first, I thought about comparing the actual position difference to the 45-degree vectors and using the smallest angle difference.<br>This had problems with vectors 180 degrees out from each other.</p>
<p>Then I tried normalising the position difference and comparing the position with the normalised 45-degree vectors.<br>This seems possible.</p>
<p><img src="/Robotic-Telepresence/2017/02/12/VR-feature-Angle-snapping/Angles.png" alt="This shows the angles to snap to"></p>
<hr>
<p>However, I haven’t tried to use Baxter yet, and I’m not sure of how the IK solver will project the path of the hand; it may not necessarily be a straight path, so this visualisation could be misleading.<br>Maybe a better way would be to replace the controller models with ghostly grippers which will remain at the target positions until the IK solver has finished.</p>
<p>I’ve also had a quick look into a Unity-based IK solver. They are common in games with avatars.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/12/VR-feature-Angle-snapping/" data-id="cizlhttbl001f509r98x0ph35" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-9" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/08/Project-meeting-9/">Project meeting 9</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/08/Project-meeting-9/" class="article-date">
  <time datetime="2017-02-08T17:56:01.000Z" itemprop="datePublished">Wed 08/02/2017 17:56</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h4 id="Safety"><a href="#Safety" class="headerlink" title="Safety"></a>Safety</h4><p>Apparently ROS has a way to set initial constraints, so that for instance, commands which tell him to move his hands into the space occupied by the table can be overridden.<br>While Baxter tends to avoid collisions with his other arms and the torso, apparently he ignores the screen on the head, so I’ll have to be careful of that.<br>If I’m going to be in VR in the robot lab, I’ll need another person to be in the room at the same time. It would be possible to start with to just not wear the headset and view the game windows on a monitor.</p>
<h4 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps"></a>Next steps</h4><p>Soon, another PC will be set up in the robot lab able to run Windows, then I can get started on practical development.<br>I still need to learn to use Baxter, but the environment should be set up for this already.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/08/Project-meeting-9/" data-id="cizlhttba0012509r0r5xe2ke" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Adding-VR-to-Unity-Project" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/07/Adding-VR-to-Unity-Project/">Adding VR to Unity Project</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/07/Adding-VR-to-Unity-Project/" class="article-date">
  <time datetime="2017-02-07T15:47:54.000Z" itemprop="datePublished">Tue 07/02/2017 15:47</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h4 id="Enabling-VR"><a href="#Enabling-VR" class="headerlink" title="Enabling VR"></a>Enabling VR</h4><p>This step was very simple.<br>A preliminary step is to ensure the Steam client is installed, along with the SteamVR application.<br>In Unity, under “Player Preferences”, tick the “Virtual Reality Supported” checkbox.<br>Done.<br>Now when SteamVR is running, pressing “Play” in Unity will focus itself in the VR headset.<br>This only enables head tracking though.<br>To get more functionality, download the free SteamVR plugin from the Unity assets store.<br>You can drag the prefabs out into the base project directory and ther controllers are shown (in the same skin as the user has set in their SteamVR preferences).<br>There seem to be some great resources for getting started, I’m using <a href="https://docs.unity3d.com/Manual/OpenVRControllers.html" target="_blank" rel="external">this page</a> for controller input.</p>
<h4 id="VR-tests"><a href="#VR-tests" class="headerlink" title="VR tests"></a>VR tests</h4><p>There seem to be many ways to access data from the headset or controllers.<br>I wrote a little script to spawn primitives at a controller’s position with a trigger press.<br>The idea is to develop it to draw commands for where to move Baxter’s hand to next.<br><figure class="highlight cs"><figcaption><span>Unity script</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ControllerTest</span> : <span class="title">MonoBehaviour</span> &#123;</div><div class="line">	<span class="keyword">private</span> SteamVR_TrackedController controller;</div><div class="line">	<span class="keyword">private</span> PrimitiveType currentPrimitiveType = PrimitiveType.Sphere;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">bool</span> arrowStarted = <span class="literal">false</span>;</div><div class="line">	<span class="keyword">private</span> Vector3 arrowStartPos;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		controller = GetComponent&lt;SteamVR_TrackedController&gt;();</div><div class="line">		controller.TriggerClicked += handle_trigger_clicked;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		controller.TriggerClicked -= handle_trigger_clicked;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handle_trigger_clicked</span>(<span class="params"><span class="keyword">object</span> sender, ClickedEventArgs e</span>) </span>&#123;</div><div class="line">		spawn_arrow_at_controller();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">spawn_sphere_at_controller</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> sphere = GameObject.CreatePrimitive(PrimitiveType.Sphere);</div><div class="line">		sphere.transform.position = transform.position;</div><div class="line">		sphere.transform.rotation = transform.rotation;</div><div class="line">		sphere.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">0.1</span>f, <span class="number">0.1</span>f, <span class="number">0.1</span>f);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">spawn_arrow_at_controller</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		GameObject cylinder;</div><div class="line">		<span class="keyword">if</span> (!arrowStarted) &#123;</div><div class="line">			arrowStartPos = transform.position;</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			cylinder = GameObject.CreatePrimitive(PrimitiveType.Cylinder);</div><div class="line">			cylinder.transform.position = (arrowStartPos + transform.position) / <span class="number">2</span>;</div><div class="line">			cylinder.transform.rotation = transform.rotation;</div><div class="line">			cylinder.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">0.1</span>f, <span class="number">0.1</span>f, <span class="number">0.1</span>f);</div><div class="line">		&#125;</div><div class="line">		arrowStarted = !arrowStarted;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><img src="/Robotic-Telepresence/2017/02/07/Adding-VR-to-Unity-Project/Cylinders.png" alt="First, just spawning at controller position"><br><img src="/Robotic-Telepresence/2017/02/07/Adding-VR-to-Unity-Project/Midpoints.png" alt="Then, pick two points and it instantiates at the midpoint"><br>I’ll be rotating and scaling the cylinders into arrows to view the expected path of a hand.</p>
<h4 id="Drawing-arrows"><a href="#Drawing-arrows" class="headerlink" title="Drawing arrows"></a>Drawing arrows</h4><p>After some tweaking, I managed to get it to be able to drag the controllers to draw ‘arrows’.<br>I’ll need to offset them, because the controller origin can’t be visually pinpointed, so it’s difficult for the user to choose a precise location.<br>The image below shows the controller origin. I’m thinking of using the very centre of the ring.</p>
<p><img src="/Robotic-Telepresence/2017/02/07/Adding-VR-to-Unity-Project/Controller.png" alt="{Red, Green, Blue} are {X, Y, Z} respectively"></p>
<p>The script below enables functionality demonstrated in the video underneath.</p>
<figure class="highlight cs"><figcaption><span>Final Unity Script</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ControllerTest</span> : <span class="title">MonoBehaviour</span> &#123;</div><div class="line">	<span class="keyword">private</span> SteamVR_TrackedController controller;</div><div class="line">	<span class="keyword">private</span> PrimitiveType currentPrimitiveType = PrimitiveType.Sphere;</div><div class="line">	<span class="keyword">public</span> GameObject prefabCylinder; <span class="comment">// Fill with arrow prefab</span></div><div class="line">	<span class="keyword">private</span> GameObject arrow; <span class="comment">// Current arrow being drawn</span></div><div class="line">	<span class="keyword">private</span> Vector3 arrowStartPos;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// Register controller callbacks</span></div><div class="line">		controller = GetComponent&lt;SteamVR_TrackedController&gt;();</div><div class="line">		controller.TriggerClicked += handle_trigger_clicked;</div><div class="line">		controller.TriggerUnclicked += handle_trigger_unclicked;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// Unegister controller callbacks</span></div><div class="line">		controller.TriggerClicked -= handle_trigger_clicked;</div><div class="line">		controller.TriggerUnclicked += handle_trigger_unclicked;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Start drawing the arrow</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handle_trigger_clicked</span>(<span class="params"><span class="keyword">object</span> sender, ClickedEventArgs e</span>) </span>&#123;</div><div class="line">		arrowStartPos = transform.position;</div><div class="line">		arrow = (GameObject)Instantiate(prefabCylinder);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Finished drawing the arrow</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handle_trigger_unclicked</span>(<span class="params"><span class="keyword">object</span> sender, ClickedEventArgs e</span>) </span>&#123;</div><div class="line">		arrow = <span class="literal">null</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="comment">// Handle arrow logic</span></div><div class="line">		<span class="keyword">if</span> (controller.triggerPressed) &#123;</div><div class="line">			<span class="keyword">var</span> direction = transform.position - arrowStartPos;</div><div class="line">			<span class="keyword">var</span> midpoint = direction/<span class="number">2</span>;</div><div class="line">			arrow.transform.rotation = Quaternion.FromToRotation(Vector3.up, direction);</div><div class="line">        	arrow.transform.localScale = <span class="keyword">new</span> Vector3(<span class="number">0.05</span>f, direction.magnitude/<span class="number">2</span>, <span class="number">0.05</span>f);</div><div class="line">			arrow.transform.position = midpoint + arrowStartPos;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<div class="video-container"><iframe src="//www.youtube.com/embed/0gkBvNeSKKs" frameborder="0" allowfullscreen></iframe></div>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/07/Adding-VR-to-Unity-Project/" data-id="cizlhtt9w0001509r2d9j4ksi" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Midterm-interview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/02/Midterm-interview/">Midterm interview</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/02/Midterm-interview/" class="article-date">
  <time datetime="2017-02-02T20:19:49.000Z" itemprop="datePublished">Thu 02/02/2017 20:19</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h4 id="Main-things-to-take-away"><a href="#Main-things-to-take-away" class="headerlink" title="Main things to take away"></a>Main things to take away</h4><p>I need to really be sure on what it is I’m trying to acheive. This should come across very clearly in the final report.<br>Rather than setting my work out in the order I discovered things (chronologically), it would be clearer if I start with broad information, and reading further qould increase the detail.</p>
<p>I need to finish the project as soon as possible, to any degree of quality. Then I should work on fleshing it out.<br>Even though I work regularly there’s a risk of not finishing, which could severely limit the available marks.<br>I’ll be working on control for Baxter and implementing VR over the next couple of weeks.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/02/Midterm-interview/" data-id="cizlhttar000k509rop9byr3e" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/02/01/Project-meeting-8/">Project meeting 8</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/02/01/Project-meeting-8/" class="article-date">
  <time datetime="2017-02-01T22:33:01.000Z" itemprop="datePublished">Wed 01/02/2017 22:33</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h4 id="Things-discussed"><a href="#Things-discussed" class="headerlink" title="Things discussed"></a>Things discussed</h4><ul>
<li>Feedback from midterm report</li>
<li>Tips for the midterm interview tomorrow</li>
<li>The existing problem with point clouds</li>
</ul>
<p>The point clouds might be getting stuck due to the sheer size of the point cloud frames.<br>If so, then cutting the resolution down could save a lot of time and processing.<br>I could test some example (smaller) clouds.<br>However, I’d expect some response from the socket node or some network activity.</p>
<p>It also could be down to the type of data, as it’s the only topic of its kind.</p>
<p>At this point, it was suggested that it might be better to directly connect the Kinect to the VR computer.<br>I’ve demonstrated some functionality for a framework for viewing ROS clouds.<br>It would free up time for working on other aspects and could be relatively straight-forward to implement and achieve good results.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/02/01/Project-meeting-8/" data-id="cizlhttb90011509rohrlyanu" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Final-structure" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/01/31/Final-structure/">Final structure</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/01/31/Final-structure/" class="article-date">
  <time datetime="2017-01-31T23:17:07.000Z" itemprop="datePublished">Tue 31/01/2017 23:17</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’ve started to write what could be the final few files, in terms of the main data communication functionality.</p>
<h4 id="Console-application"><a href="#Console-application" class="headerlink" title="Console application"></a>Console application</h4><p>This will be the ROS node, which connects to a serial server (socket).<br>It will subscribe to whichever topics are required and set up shared memory for each. As I can have many parallel shared spaces I think this is easier than trying to navigate a single one.<br>I’m trying a class-based approach to keep things tidy and encapsulated.<br>I had a lot of problems trying to encapsulate the callbacks (required), so in the end I’ve left some of it in <code>main()</code>.</p>
<p>As the shared memory can only be written in integers, I’ll have to convert the joint angles (floats) back in to 4xbytes. Here’s a reason to convert bytes into floats in the Unity script (point clouds).</p>
<h4 id="Unity-application"><a href="#Unity-application" class="headerlink" title="Unity application"></a>Unity application</h4><p>Once the data’s in the shared space, it will probably be just a block of integers. I’ll have to know how to read things in the correct order.<br>I’ve not worked out splitting work into individual threads yet, but I know it’s supported and doable.<br>I plan to have the VR in one (I think this might be automatic), point clouds in another (they will be intensive) and anything else in another? Perhaps keep a limit of 4 cores?</p>
<h4 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h4><p>Following <a href="/2016/12/07/Point-Cloud-from-Actual-Data/">the last time I tried this</a> I ran into the same problem.<br>Even trying to send a single point cloud over the socket, the virtual machine’s CPU jumps to around 20%, never completes, no errors are displayed but the <code>rosserial_server</code> node has silently crashed.<br>I’m hoping this is due to complications with it being the same physical machine and it being virtualised, but there’s no problems with the joint angles at all.<br>I’ll have to run this in the robot lab.</p>
<p>Using <code>std::vec</code> made sense for making a more robust program, but I had to convert it back into an array for the <code>CopyMemory()</code> function for shared memory and I ran into all sorts of endian-ness problems. They were difficult to spot as printing the contents to <code>stdout</code> didn’t show any problems.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/01/31/Final-structure/" data-id="cizlhttai000c509rji5zllhj" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Named-shared-memory-Episode-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/01/18/Named-shared-memory-Episode-3/">Named shared memory: Episode 3</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/01/18/Named-shared-memory-Episode-3/" class="article-date">
  <time datetime="2017-01-18T14:40:07.000Z" itemprop="datePublished">Wed 18/01/2017 14:40</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h3 id="Inter-process-communication"><a href="#Inter-process-communication" class="headerlink" title="Inter-process communication"></a>Inter-process communication</h3><p>Following the success of <a href="/Robotic-Telepresence/2016/12/03/Named-Shared-Memory-Episode-2/">Named Shared Memory: Episode 2</a>, it wasn’t too far to be able to see the message generated in one process in the Unity debug log.<br>As long as it’s known what data is expected at which offsets it can be reconstructed.<br>The only function data types available are:</p>
<blockquote>
<ul>
<li>Byte</li>
<li>Int16</li>
<li>Int32</li>
<li>Int64</li>
<li>IntPtr</li>
</ul>
</blockquote>
<p>Luckily these can be cast to whatever you like.</p>
<p><img src="/Robotic-Telepresence/2017/01/18/Named-Shared-Memory-Episode-3/Message.png" alt="Process writing the message can be started before or after Unity starts"></p>
<p>I’ve had trouble casting to floats from Int32s.<br>I’ve come across ‘BitConverter.ToSingle’ which does the same task as the byte/float union in my console application.<br>Perhaps I could use a <code>.dll</code> after all.</p>
<h3 id="Project-structure"><a href="#Project-structure" class="headerlink" title="Project structure"></a>Project structure</h3><p>I’ve decided to make the console application the smallest middle-man possible, so it will only transfer the data to the shared memory.<br>Any multithreading will be solely handled by Unity.<br>I’ve managed to get this working, but it has not reduced the time yet (still at ~19 seconds for a single frame).<br>I think this is because earlier it was reading from a stream, writing to another stream and having that stream being read which could pipeline.<br>Now it’s only doint the first read from a stream.<br>I will see what it’s like by combining the <code>NamedSharedMemory</code> project and the <code>rosserial</code> projects, cutting out any streams.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/01/18/Named-shared-memory-Episode-3/" data-id="cizlhttat000m509r5phubng3" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-PCL-point-clouds" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/">PCL point clouds</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/" class="article-date">
  <time datetime="2017-01-03T21:06:59.000Z" itemprop="datePublished">Tue 03/01/2017 21:06</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Now I have a list of 200kB files (<code>xaa</code>, <code>xab</code>, <code>xac</code> etc.), split from the first PointCloud2 message in the <code>rosbag</code>.<br>Viewing the ascii <code>.pcd</code> file, I found what looked like the start of meaningful data, at point 29515.<br>Doing some arithmetic led me to the 17th file, or <code>xaq</code>.<br>I used this to confirm my program wasn’t working.</p>
<h3 id="BUG"><a href="#BUG" class="headerlink" title="BUG"></a>BUG</h3><p>I’ve just realised that I wasn’t discarding data properly!<br>The offsets of 4 bytes of 0, 1, 2 and 4 are required, but I wasn’t discarding 3, 5, 6 or 7!<br>Along with making sure the commas were removed: Success!!<br><img src="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/Conversion Success.png" alt="Using a custom segment of data which won&#39;t return NaNs"></p>
<p>I needed to adapt the program to skip the header parts of the message to only read the data.<br>I ran it on a full message and it took a couple of minutes to finish printing, but it worked.<br>Removing the printing functionality sped it up to about 20 seconds.<br><strong>This needs to be faster!</strong><br>I can optimise the code a bit more, and it’s only running on a single core.<br>I can also get Unity to read from RAM rather than wait for stdout redirection.</p>
<h3 id="Into-Unity"><a href="#Into-Unity" class="headerlink" title="Into Unity"></a>Into Unity</h3><p>I can call the program in Unity, however it does not close automatically.<br>I realised that this is caused by redirecting standard output into Unity.<br>By completely reading everything in the buffer, it is fixed.</p>
<p>I got it to display the first 65000 points of a whole message.<br><img src="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/First 65000 White.png" alt="It&#39;s white because there&#39;s a problem with the rendering I haven&#39;t realised yet."><br>65000 is the maximum number of vertices in a mesh in Unity.<br>I’ll have to split the cloud into submeshes.</p>
<h3 id="More-hindsight"><a href="#More-hindsight" class="headerlink" title="More hindsight"></a>More hindsight</h3><p>I’ve made another mistake. After a long time of trial and error, I’ve found that while you can split a mesh into submeshes, the overall limit is still 65000 points because it’s actually still one mesh.<br>The purpose of submeshes is for different materials.<br>I’ll have to make more GameObjects with their own meshes.</p>
<h3 id="Full-mesh"><a href="#Full-mesh" class="headerlink" title="Full mesh"></a>Full mesh</h3><p>A partial success, but the colours still don’t work and the rotation is wrong.<br><img src="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/Full Selection.png" alt="The cloud is structured in strips, from Baxter&#39;s back to front"><br>To fix the colours, I’ve realised that the colours are supposed to be between 0 and 1, not 0 and 255.<br>To fix the rotation, I need to find out the base transformation.</p>
<h3 id="Colours"><a href="#Colours" class="headerlink" title="Colours"></a>Colours</h3><p>But the colours seem wrong.<br>Perhaps this is to do with endian-ness I didn’t account for.<br><img src="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/Colours Wrong.png" alt="It&#39;s not just my eyes? I think?"><br>Yep! That was it. Now for the transformation.<br><img src="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/Colours Fixed.png" alt="Phew"></p>
<h3 id="Transformation"><a href="#Transformation" class="headerlink" title="Transformation"></a>Transformation</h3><p>This was quite difficult to find.<br>The Googlable phrases were all quite similar, and most people were trying to <em>set</em> the transform, not <em>get</em> it.<br>I started with <code>RViz</code> again. I remember having to set the base transform for viewing the octomap.<br>This didn’t exactly help, although I saw some error messages which said:<br><figure class="highlight plain"><figcaption><span>In RViz</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Failed to transform from frame [camera_rgb_optical_frame] to frame [base]</div></pre></td></tr></table></figure></p>
<p>This gave me a bit more to go on. From the <code>PointCloud2</code> message itself, I knew it used the <code>camera_rgb_optical_frame</code>.<br>This eventually led me to <code>tf_echo</code>:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ rosrun tf tf_echo camera_rgb_optical_frame base</div><div class="line">At time 1479833365.881</div><div class="line">- Translation: [-0.024, -0.546, 1.873]</div><div class="line">- Rotation: <span class="keyword">in</span> Quaternion [0.708, 0.675, -0.154, 0.145]</div><div class="line">            <span class="keyword">in</span> RPY (radian) [-3.139, 0.425, 1.524]</div><div class="line">            <span class="keyword">in</span> RPY (degree) [-179.836, 24.340, 87.300]</div><div class="line"></div><div class="line">$ rosrun tf tf_echo base camera_rgb_optical_frame</div><div class="line">At time 1479833366.181</div><div class="line">- Translation: [1.270, 0.003, 1.481]</div><div class="line">- Rotation: <span class="keyword">in</span> Quaternion [0.708, 0.675, -0.154, -0.145]</div><div class="line">            <span class="keyword">in</span> RPY (radian) [-2.717, 0.022, 1.528]</div><div class="line">            <span class="keyword">in</span> RPY (degree) [-155.691, 1.276, 87.539]</div></pre></td></tr></table></figure></p>
<p>I 100% wasn’t sure which way around it was, so I tried both.<br>Using my knowledge from the <a href="/Robotic-Telepresence/2016/11/14/URDF-importer/">URDF importer</a>, I made a Unity script to convert these into the native frame.<br>By negating the X translation, rotating by -90 degrees in X, then rotating by -Z, then -Y, then +X with the values for the translation from <code>base</code> to <code>camera_rgb_optical_frame</code>, it worked:<br><img src="/Robotic-Telepresence/2017/01/03/PCL-point-clouds/Complete.png" alt="It still seems off, probably not my fault."><br>Thankfully, the point clouds are dense enough for now to not worry about them being represented by single pixels.<br>There seem to be no performance issues whatsoever.</p>
<h3 id="Still-lots-to-do"><a href="#Still-lots-to-do" class="headerlink" title="Still lots to do"></a>Still lots to do</h3><p>I still have to work out how to make this not take 20 seconds each frame, while still allowing other processes to run.<br>Not to mention bringing everything together…</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/01/03/PCL-point-clouds/" data-id="cizlhttax000q509r7tksdxq7" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Converting-point-clouds-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2017/01/02/Converting-point-clouds-2/">Converting point clouds 2</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2017/01/02/Converting-point-clouds-2/" class="article-date">
  <time datetime="2017-01-02T13:47:58.000Z" itemprop="datePublished">Mon 02/01/2017 13:47</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>To further my investigation of why I was unable to convert the PointCloud2 messages into usable values, I tried using <code>Rviz</code>, which I know can view the data properly.<br>It’s a hassle as I have to restart my PC, and I lose access to most of my development tools (rviz won’t run in a virtual machine).<br>If I can export some of the data, I’ll have something to compare the results of my program to.<br><code>rviz</code> showed how many messages were coming through, and you could select an area of points to see their data. However, you couldn’t select <em>all</em> points, or export the data.</p>
<p>Later, I came across a tool called <code>bag_to_pcd</code> <a href="http://re.je/notes/2013/capturing-point-clouds-with-pcl-tools/" target="_blank" rel="external">here</a>.<br>I converted each message in the bag to a <code>.pcd</code> file, and then converted the first one into other formats from there.<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ sudo add-apt-repository ppa:v-launchpad-jochen-sprickerhof-de/pcl</div><div class="line">$ sudo apt update</div><div class="line">$ sudo apt install libpcl-all</div><div class="line">$ sudo apt install libpcl-all-dev</div><div class="line">$ sudo apt install ros-indigo-perception</div><div class="line"></div><div class="line">$ rosrun pcl_ros bag_to_pcd ~/Downloads/baxter.bag /camera/depth_registered/points ~/Downloads</div><div class="line">$ pcl_pcd2ply 1479833365.438671766.pcd output.ply</div><div class="line">$ pcl_convert_pcd_ascii_binary 1479833365.438671766.pcd output.pcd 0</div></pre></td></tr></table></figure></p>
<p>I was left with a binary <code>.pcd</code> file, an ascii <code>.pcd</code> file, and a binary <code>.ply</code> file (which didn’t work, unexpected eof even with trailing newline)</p>
<p>I could view them to make sure they were still OK using <code>pcd_viewer</code><br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rosrun perception_pcl pcd_viewer output.pcd</div></pre></td></tr></table></figure></p>
<p><img src="/Robotic-Telepresence/2017/01/02/Converting-point-clouds-2/View PCL.png" alt="Incredibly buggy in my virtual machine!"></p>
<h3 id="New-information"><a href="#New-information" class="headerlink" title="New information"></a>New information</h3><p>When viewing the ascii <code>.pcd</code> file, it became apparent that huge sections at the start and end of the file was meaningless data.<br>This could help to explain why I wasn’t getting anywhere.<br>I also learned that a devices like a kinect will often output <code>nan</code> values if the incident ray wasn’t returned.</p>
<p>I’ll have to re-export the <code>rosbag</code> message, so that it’s the first message in the bag. Then I can compare my results to the actual points.<br>Hopefully then I can come up with a way to filter out the bad data efficiently.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2017/01/02/Converting-point-clouds-2/" data-id="cizlhtta30004509rkx9pbc4v" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/14/Project-meeting-7/">Project meeting 7</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/14/Project-meeting-7/" class="article-date">
  <time datetime="2016-12-14T12:32:16.000Z" itemprop="datePublished">Wed 14/12/2016 12:32</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h5 id="Project-progress"><a href="#Project-progress" class="headerlink" title="Project progress"></a>Project progress</h5><p>I’m still not sure why I had so much trouble converting 3D-space points back into floats.<br>However, there should be a library in <code>ROS</code> for PCL, which is what I should be using after all.</p>
<h5 id="Interim-report-plan-feedback"><a href="#Interim-report-plan-feedback" class="headerlink" title="Interim report plan feedback"></a>Interim report plan feedback</h5><p>I received some feedback about the structure of the report.<br>I should think about it more logically, and get somebody else to read it.<br>I’ll also be including multiple revisions of Gantt charts, including an<br>up-to-date version.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/14/Project-meeting-7/" data-id="cizlhttb80010509rwrwekpux" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Converting-point-clouds" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/07/Converting-point-clouds/">Converting point clouds</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/07/Converting-point-clouds/" class="article-date">
  <time datetime="2016-12-07T21:33:29.000Z" itemprop="datePublished">Wed 07/12/2016 21:33</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I spent a long time trying to write something which formats a message into data useable by Unity for generating a vertex mesh.<br>It should have been easier, but I ran into a lot of issues.</p>
<p>The general idea is to convert 4 bytes of the 32-byte point data to a float for each of X, Y, and Z.<br>The message even states the endian-ness of this layout (<a href="http://docs.ros.org/api/sensor_msgs/html/msg/PointCloud2.html" target="_blank" rel="external">documentation</a>).</p>
<p>I learned of the <strong>union</strong>:<br><figure class="highlight cpp"><figcaption><span>Conversion code</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">union</span> &#123;</div><div class="line">  <span class="keyword">float</span> f;</div><div class="line">  <span class="keyword">int</span> b[<span class="number">4</span>];</div><div class="line">&#125; data;</div></pre></td></tr></table></figure></p>
<p>I couldn’t use the whole data from a single message each time, I couldn’t even open it in a text editor as it was too large.<br>Fortunately I could split the file without even opening it.<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ split -b 200000 PointCloud.txt</div></pre></td></tr></table></figure></p>
<p>This generated a list of 200kB files, with <code>xaa</code> being the start with the header messages.</p>
<p>Whatever I did to the conversion program, I was always getting <code>nan</code> values, or crazily small ones.<br>I read about using the pcl library to use their methods for this rather than me implementing something myself.<br>Such methods exist in <code>pcl_ros/point_cloud.h</code>. However, this resource and the resources it depends on are part of the <code>ROS</code> environment.<br>Ideally, The Windows side would do the work, so that the Linux side only publishes the related data. It shouldn’t have to know what’s on the other end.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/07/Converting-point-clouds/" data-id="cizlhtta80005509rdktwf495" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Point-cloud-from-actual-data" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/07/Point-cloud-from-actual-data/">Point cloud from actual data</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/07/Point-cloud-from-actual-data/" class="article-date">
  <time datetime="2016-12-07T13:03:08.000Z" itemprop="datePublished">Wed 07/12/2016 13:03</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>There were some errors in the <a href="/Robotic-Telepresence/2016/12/05/Point-Clouds-in-Unity/">previous post</a>.<br>There were 9,830,400 individual numbers in a single frame of the point cloud in the <code>rosbag</code>.<br>Looking at the <a href="http://docs.ros.org/api/sensor_msgs/html/msg/PointCloud2.html" target="_blank" rel="external">documentation</a> for the message type, and the header of the message, the number of points is far fewer.<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$ rostopic <span class="built_in">echo</span> --noarr --nostr /camera/depth_registered/points</div><div class="line">header: </div><div class="line">  seq: 16832</div><div class="line">  stamp: </div><div class="line">    secs: 1479833365</div><div class="line">    nsecs: 438671766</div><div class="line">height: 480</div><div class="line">width: 640</div><div class="line">is_bigendian: False</div><div class="line">point_step: 32</div><div class="line">row_step: 20480</div><div class="line">is_dense: False</div><div class="line">---</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><figcaption><span>Message header</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">fields: </div><div class="line">  - </div><div class="line">    name: x</div><div class="line">    offset: 0</div><div class="line">    datatype: 7</div><div class="line">    count: 1</div><div class="line">  - </div><div class="line">    name: y</div><div class="line">    offset: 4</div><div class="line">    datatype: 7</div><div class="line">    count: 1</div><div class="line">  - </div><div class="line">    name: z</div><div class="line">    offset: 8</div><div class="line">    datatype: 7</div><div class="line">    count: 1</div><div class="line">  - </div><div class="line">    name: rgb</div><div class="line">    offset: 16</div><div class="line">    datatype: 7</div><div class="line">    count: 1</div></pre></td></tr></table></figure>
<p>The width and height of the cloud from the Kinect 1 is 640x480, with 32 bytes for each point.<br><code>9830400 / (640 * 480) = 32</code><br>According to the documentation for the <a href="http://docs.ros.org/api/sensor_msgs/html/msg/PointField.html" target="_blank" rel="external">PointField</a> message, each datum uses <code>datatype: 7</code>, which is a <code>FLOAT32</code>. This means 32 bits, or 4 bytes.<br>The data values in the PointCloud2 message are of type <code>uint8</code>, which uses 8 bits, or 1 byte.<br>This means that for each point in the message, there’s space for 8x <code>float32</code>.</p>
<p>Examining the first 32 bytes of the first message, the fields described in the message header are visible:<br><figure class="highlight plain"><figcaption><span>First point in first message</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">0 0 192 127 //x</div><div class="line">0 0 192 127 //y</div><div class="line">0 0 192 127 //z</div><div class="line">0 0 0 0</div><div class="line">131 115 115 255 //rgb</div><div class="line">0 0 0 0</div><div class="line">0 0 0 0</div><div class="line">0 0 0 0</div></pre></td></tr></table></figure></p>
<p>For some reason, playing the rosbag with a windows listener subscribed to the point cloud, causes the <code>socket_node</code> to hang, even on one message, with network activity dropping to zero.<br>This happens even when minimally changed from subscribing to <code>JointStates</code>, (which works perfectly), and not storing or printing the output.<br>The same happens with octomap, which has significatnly smaller messages.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/07/Point-cloud-from-actual-data/" data-id="cizlhttau000o509r31ktu5t6" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Point-clouds-in-Unity" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/05/Point-clouds-in-Unity/">Point clouds in Unity</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/05/Point-clouds-in-Unity/" class="article-date">
  <time datetime="2016-12-05T23:41:03.000Z" itemprop="datePublished">Mon 05/12/2016 23:41</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Giving the <code>NamedSharedMemory</code> a bit of a break while I focus on point clouds.<br>If I can’t get <code>NamedSharedMemory</code> to work, I’ve always got the slower less efficient stdout redirection into Unity.</p>
<h5 id="Method"><a href="#Method" class="headerlink" title="Method"></a>Method</h5><p>The example point clouds which I was provided with were very large.</p>
<blockquote>
<table>
<thead>
<tr>
<th>File</th>
<th>Size</th>
<th>Vertices</th>
</tr>
</thead>
<tbody>
<tr>
<td>Kinect_Aligned_ColourFromOscar_Subsampled.ply</td>
<td>6.7MB</td>
<td>419,033</td>
</tr>
<tr>
<td>Oscar_Monocular_Reconstruction_Cloud.ply</td>
<td>17.9MB</td>
<td>396,257</td>
</tr>
<tr>
<td>Kinect_Aligned.ply</td>
<td>449.7MB</td>
<td>37,478,946</td>
</tr>
<tr>
<td>Kinect_Aligned_ColourFromOscar.ply</td>
<td>599.7MB</td>
<td>37,478,946</td>
</tr>
</tbody>
</table>
</blockquote>
<p><img src="/Robotic-Telepresence/2016/12/05/Point-Clouds-in-Unity/Subsampled.png" alt="The smallest point cloud, which has been edited by hand"><br>The best way to draw them would be to take advantage of the GPU.<br>By using a vertex shader, we can make each point in the cloud a vertex.<br>I grabbed some code from <a href="http://www.kamend.com/2014/05/rendering-a-point-cloud-inside-unity/" target="_blank" rel="external">here</a> to adapt and try out.<br>Unity only allows 65,534 vertices for each mesh, at which it is split into multiple meshes.<br>My computer, with the recommended GPU for entry-level VR had no trouble at all rendering 60,000 points in a cube.<br><img src="/Robotic-Telepresence/2016/12/05/Point-Clouds-in-Unity/60k Cube.png" alt=""><br>This is ~500 times fewer points than in the largest <code>.ply</code> file, but I don’t know how large it will <em>need</em> to be.<br>I couldn’t work out how to vary the point size. The functionality should be enabled by a script attached to the camera which specifies:<br><figure class="highlight cs"><figcaption><span>PointCLoudConfig.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> UInt32 GL_VERTEX_PROGRAM_POINT_SIZE = <span class="number">0x8642</span>;</div><div class="line">glEnable(GL_VERTEX_PROGRAM_POINT_SIZE);</div></pre></td></tr></table></figure></p>
<h5 id="rosbag-Point-Cloud"><a href="#rosbag-Point-Cloud" class="headerlink" title="rosbag Point Cloud"></a><code>rosbag</code> Point Cloud</h5><p>In order to find how many points I should expect, I ran the <code>rosbag</code> step by step until a message containing the output was printed, which I redirected to a file.<br>The file caused my text editor to not be very responsive. I found the commas were only present in the list of points, so I counted them without opening the file.<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ rosbag play ~/Downloads/baxter.bag --pause <span class="_">-l</span></div><div class="line">$ rostopic <span class="built_in">echo</span> /camera/depth_registered/points | tee ~/PointCloud.txt</div><div class="line">$ fgrep -o <span class="string">","</span> ~/PointCloud.txt | wc <span class="_">-l</span></div><div class="line">9830399</div></pre></td></tr></table></figure></p>
<p>This gave a file of 36.5MB, with 9,830,400 points, which would split into 151 meshes.</p>
<p>I wrote a little script which would create <code>X</code> number of child <code>GameObjects</code>, each drawing 60,000 points in the new shader, offset by 10 units.<br><figure class="highlight cs"><figcaption><span>CreatePointCloudObject.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CreatePointCloudObjects</span> : <span class="title">MonoBehaviour</span> &#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> num_clouds = <span class="number">0</span>;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		Material mat = Resources.Load(<span class="string">"PointCloud"</span>, <span class="keyword">typeof</span>(Material)) <span class="keyword">as</span> Material;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;num_clouds; i++) &#123;</div><div class="line">			GameObject gameObject = <span class="keyword">new</span> GameObject(<span class="string">"PointCloud fragment"</span>);</div><div class="line">			gameObject.transform.SetParent(<span class="keyword">this</span>.transform);</div><div class="line">			gameObject.AddComponent&lt;PointCloud&gt;(); <span class="comment">//MeshRenderer and MeshFilter already added by script</span></div><div class="line">			gameObject.GetComponent&lt;MeshRenderer&gt;().material = mat;</div><div class="line">			gameObject.transform.position = <span class="keyword">new</span> Vector3((<span class="keyword">float</span>)i*<span class="number">10</span>, <span class="number">0.0</span>f, <span class="number">0.0</span>f);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>When increasing <code>X</code> to 164, it also seemed to run without issue.<br><img src="/Robotic-Telepresence/2016/12/05/Point-Clouds-in-Unity/All Points.png" alt="Drawing 9,840,000 vertices with random vertex colours, at 1px per vertex"></p>
<h5 id="Changing-point-size"><a href="#Changing-point-size" class="headerlink" title="Changing point size"></a>Changing point size</h5><p>I realised that whist the <code>GL_VERTEX_PROGRAM_POINT_SIZE</code> was being enabled, it wasn’t being enabled because I was running in DirectX11.<br>By going to <code>Edit &gt; Project Settings &gt; Player &gt; Other Settings</code> and unchecking <code>Auto Graphics API for Windows</code>, I was given the option to enable OpenGLCore and move it to the top of the list.<br>Now the property was being enabled (only when viewing through the scene camera, not the editor) but I wasn’t seeing any changes.<br>I still can’t get it to work.<br><a href="http://1darray.com/blog/2012/09/01/xyz-point-cloud-data-viewer-dx11/" target="_blank" rel="external">This guy</a> seems to have a very capable asset package for point clouds, but he won’t give any information away because he’s selling his work.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/05/Point-clouds-in-Unity/" data-id="cizlhttay000r509r2c5i1k68" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Named-shared-memory-Episode-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/03/Named-shared-memory-Episode-2/">Named shared memory: Episode 2</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/03/Named-shared-memory-Episode-2/" class="article-date">
  <time datetime="2016-12-03T01:07:37.000Z" itemprop="datePublished">Sat 03/12/2016 01:07</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I did a lot of looking around, and I could find very occasional signs that some people had been able to get named shared memory working with Unity.<br>Eventually I found <a href="http://answers.unity3d.com/questions/1249732/how-to-use-shared-memory-in-unity.html" target="_blank" rel="external">this forum question</a> which showed some example code for Unity C# and other C++.<br>The C++ code I could tell had been adapted from the <a href="https://msdn.microsoft.com/en-us/library/aa366551.aspx" target="_blank" rel="external">MSDN page</a> I got mine from, which had been adapted.<br>I adapted it some more to fit the other end and made it into a Unity Script.</p>
<p>After learning I needed to use unsafe operations, I found out that to enable them you had to add a file in yout assets called <code>smcs.rsp</code>.<br>This turned out to be different if you enabled the full .NET 2.0 API compatibility level, being <code>gmcs.rsp</code>.<br>This also turned out to be depreceated, so I used <code>mcs.rsp</code> instead.<br>It should contain the line:<br><figure class="highlight plain"><figcaption><span>mcs.rsp</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-unsafe</div></pre></td></tr></table></figure></p>
<p>I couldn’t get the ends to connect. I tried removing the <code>Global\\</code> from the file mapping name. Now administrator access is no longer required.<br>In the console, It showed signs of life at the other end:<br><img src="/Robotic-Telepresence/2016/12/03/Named-shared-memory-Episode-2/Life.png" alt="Although I haven&#39;t even checked what data transfer is supposed to be happening"></p>
<p>I’ve somehow broken my Visual Studio projects which use the ROS library.<br>Including <code>&lt;windows.h&gt;</code> somehow conflicts with <code>&quot;ros.h&quot;</code>.<br>I <em>need</em> <code>windows.h</code> for <code>CreateFileMapping()</code>.<br>Fixed!<br>The solution was: <code>windows.h</code> was #defining <code>ERROR</code>, which was being used in <code>ros/Log.h</code>.<br>Adding a <code>#undef ERROR</code> at the start made it build.</p>
<h3 id="Putting-ROS-messages-into-shared-memory"><a href="#Putting-ROS-messages-into-shared-memory" class="headerlink" title="Putting ROS messages into shared memory"></a>Putting ROS messages into shared memory</h3><p>The example uses <code>CopyMemory()</code> to put a string into shared memory.<br>I’ll need to know the size of the message.<br>Looking at <code>JointState.h</code> in the ROS library in Windows, I was able to see how the joint messages were built and how to determine their sizes</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/03/Named-shared-memory-Episode-2/" data-id="cizlhttao000i509rkew2od8p" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Named-shared-memory" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/02/Named-shared-memory/">Named shared memory</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/02/Named-shared-memory/" class="article-date">
  <time datetime="2016-12-02T10:56:53.000Z" itemprop="datePublished">Fri 02/12/2016 10:56</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>There seem to be more easily found resources for these.</p>
<ul>
<li>Memory is broken into pages, so buffer space is rounded to the next available size</li>
</ul>
<p>In order for the data to be accessible globally, you must set the <code>Global</code> flag in its name:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TCHAR szName[] = TEXT(<span class="string">"Global\\MyFileMappingObject"</span>);</div></pre></td></tr></table></figure></p>
<p>This requires Administrator privileges (<code>SeCreateGlobalPrivilege, SE_CREATE_GLOBAL_NAME</code>).<br>Running Visual Studio as administrator is supposed to make it so that any program run in the debugger is also run with privileges.<br>This was true, as the return value from <code>GetLastError()</code> went from <code>5</code> (cannot access) to <code>2</code> (no idea).<br>I couldn’t solve this, but running the built executables outside as administrator worked as expected.</p>
<p>While I’m on the subject of learning how Visual Studio actually works, I’ve repackaged and renamed each project and put them all into one solution, which accesses a single instance of the built <code>ros_lib</code> library for <code>rosserial_windows</code>.</p>
<p>I was just trying to create a file mapping in a Unity script…</p>
<blockquote>
<p>error CS0234: The type or namespace name <code>MemoryMappedFiles</code> does not exist in the namespace <code>System.IO</code></p>
</blockquote>
<p>System.IO.MemoryMappedFiles is only available in .NET 4.0 or later, and Unity is still using .NET 3.5 (.NET 2.0 CLR), not likely to be updated for a long time. Bummer.</p>
<p>It looks like there could be a wrapper, <a href="https://github.com/tomasr/filemap/tree/master" target="_blank" rel="external">filemap</a>.<br>I got it to compile, and I’m left with a <code>.dll</code>. I’m not sure how to use it (the repository has no documentation) and I’m pretty sure I’ll have to edit it to make it compaitble with Unity so I’m not very hopeful.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/02/Named-shared-memory/" data-id="cizlhttaw000p509rzydrsc3i" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Named-pipe-dll" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/01/Named-pipe-dll/">Named pipe dll</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/01/Named-pipe-dll/" class="article-date">
  <time datetime="2016-12-01T20:56:37.000Z" itemprop="datePublished">Thu 01/12/2016 20:56</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I had to enable CLR support for the <code>System</code> namespaces.</p>
<blockquote>
<p>Project &gt; rosserial_unity Properties &gt; Configuration Properties &gt; General &gt; Project Defaults &gt; Common Language Runtime Support &gt; enable /clr</p>
</blockquote>
<p>I didn’t know that Unity keeps a track of all global classes in the assets (seems obvious now). I moved the StreamString class definition to a separate script.<br>I moved the pipe server code into a DLL. It compiled and could run, but caused Unity to hang.<br>I moved the while loop out of the <code>Main()</code> function and put it into a separate function which is to be called by Unity’s <code>Update()</code>.<br>This meant I had to make <code>PipeServer::server</code> global, which caused <code>server == null</code> to happen in some places.</p>
<p>It took a while! I ended up with this structure:</p>
<ul>
<li>A <code>.dll</code> to open a named pipe called “rospipe”. When the pipe is connected to, it would send “Hello Unity”, and then close it.</li>
<li>A <code>GameObject</code> to call the <code>.dll</code> and open the pipe. Once it’s confirmed to be open, it enables the next <code>GameObject</code>:</li>
<li>A <code>GameObject</code> which connects to the pipe “rospipe” if it exists, and listens for messages.</li>
</ul>
<p><img src="/Robotic-Telepresence/2016/12/01/Named-pipe-dll/Debug Log.png" alt="Proof. The string exists only in the .dll, and no other programs were running"></p>
<p>Maybe I will have to use <code>WaitNamedPipe</code> (<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa365800.aspx" target="_blank" rel="external">MSDN</a>)? When trying to debug, I got an error in Visual Studio:</p>
<blockquote>
<p>Exception thrown: ‘System.IO.IOException’ in System.Core.dll<br>An unhandled exception of type ‘System.IO.IOException’ occurred in System.Core.dll<br>Additional information: All pipe instances are busy.</p>
</blockquote>
<p>I also added a <code>close_pipe</code> function, now that we don’t want to necessarily close straight after initilasing. It should trigger when I stop the game using the <code>OnApplicationQuit()</code> callback.<br>It doesn’t seem to work, though.<br>Every second time I try to run the game, Unity crashes.<br>I’m using <code>PipeServer.Close()</code> which runs, but <code>PipeServer.Disconnect()</code> and <code>PipeDispose.()</code> crashed things immediately.<br>After a long time, I realised it was caused by the <code>.dll</code> having <code>close_pipe()</code> as a <code>void</code> return, but Unity had it as a <code>bool</code> return. D’Oh!<br>Now I can run the code a few times before crashing. Wow!</p>
<p>I’ve set the PipeDirection in the <code>.dll</code> to ‘Out’ rather than 2-way.<br>It took me too long to realise I had to change the other end to ‘In’…</p>
<h1 id="I’ve-made-a-terrible-mistake"><a href="#I’ve-made-a-terrible-mistake" class="headerlink" title="I’ve made a terrible mistake"></a>I’ve made a terrible mistake</h1><p>As educational this was, I’m trying to write values which overwrite the old ones, regardless of whether they were read or not.<br>The data in named pipes MUST be read on the receiving end in the same order, FIFO.<br>I have, however, gained a much better understanding of how all of this works, and some new keywords for Googling.<br><a href="https://msdn.microsoft.com/en-us/library/aa365574%28v=vs.85%29.aspx" target="_blank" rel="external">Here</a> is a list of IPC (inter-process communication) methods provided by Windows.<br>I’ll choose one of these.</p>
<blockquote>
<table>
<thead>
<tr>
<th>Axis</th>
<th>Info</th>
</tr>
</thead>
<tbody>
<tr>
<td><del>Clipboard</del></td>
<td>The user might want to use this/overwrite the data</td>
</tr>
<tr>
<td><del>COM</del></td>
<td>This looks like it is built for other purposes, it uses ActiveX Object Services</td>
</tr>
<tr>
<td>Data Copy</td>
<td></td>
</tr>
<tr>
<td><del>DDE</del></td>
<td>“Not as efficient as newer technologies”. We need this to be as fast as possible</td>
</tr>
<tr>
<td><strong>File Mapping</strong></td>
<td>This sounds good. Programs treat the memory as their own. You can even do <em>named</em> file mapping. Many other IPC methods are based on this so generally have poorer performance</td>
</tr>
<tr>
<td><del>Mailslots</del></td>
<td>Messages are short (400 bytes) and are FIFO</td>
</tr>
<tr>
<td><del>Pipes</del></td>
<td>As mentioned, is strictly FIFO</td>
</tr>
<tr>
<td>RPC</td>
<td></td>
</tr>
<tr>
<td>Windows Sockets</td>
<td>Intended for network communications, can be TCP or UDP. Not so high performance</td>
</tr>
</tbody>
</table>
</blockquote>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/01/Named-pipe-dll/" data-id="cizlhttaq000j509rz3qo7inm" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Data-to-Unity-from-RAM" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/01/Data-to-Unity-from-RAM/">Data to Unity from RAM</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/01/Data-to-Unity-from-RAM/" class="article-date">
  <time datetime="2016-12-01T17:18:29.000Z" itemprop="datePublished">Thu 01/12/2016 17:18</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I started by copying code from the “rosserial_hello_world” and “rosserial_unity” (<code>.dll</code> code) solutions into a new solution.</p>
<p>I’m looking up how to create shared memory in Windows for sharing the data.<br>You can’t feasibly do this in a <code>.dll</code> because the space would have to be initialised statically.<br>The way to do this seems to be using <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa366551.aspx" target="_blank" rel="external">Named Shared Memory</a>.<br>Unfortunately, it seems that I might still have to worry about marshal functions or ‘unsafe’ code because of the C# in Unity.<br>An alternative could be <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa365590.aspx" target="_blank" rel="external">Named Pipes</a>.</p>
<h6 id="Named-pipes"><a href="#Named-pipes" class="headerlink" title="Named pipes"></a>Named pipes</h6><p>I made <em>another</em> visual studio solution to test this, and created an empty <code>GameObject</code> in Unity with a new script for the other end.<br>In order for some classes to be valid such as <code>System.IO.Pipes</code>, I changed the project settings to handle the full .Net 2.0:</p>
<blockquote>
<p>Edit &gt; Project Settings &gt; Player &gt; Other Settings &gt; Optimization &gt; Api Compitbility Level &gt; “.NET 2.0”<br>(rather than “.NET 2.0 Subset”)</p>
</blockquote>
<p>For the Unity side, I found some recent example code on the <a href="http://answers.unity3d.com/questions/483123/how-do-i-get-named-pipes-to-work-in-unity.html#answer-1272634" target="_blank" rel="external">Unity3D forums</a>.<br>It pointed me to the <a href="https://msdn.microsoft.com/en-us/library/bb546085%28v=vs.110%29.aspx" target="_blank" rel="external">“How to use names pipes for network interprocess communication” MSDN page</a>.<br>I copied the C++ code from the example just to see if it would compile, or work in any way.<br>I made sure that the <code>NamedPipeClientStream</code> for each end had the same name (“testpipe” for now).<br>At first, I was successful, except Unity got stuck in the starting state, and became unresponsive and needed to be forced quit.<br><img src="/Robotic-Telepresence/2016/12/01/Standalone-rosserial-application/Connection.png" alt="The &#39;PipeDataSend&#39; Windows console application, after running Unity"><br>With a bit of tweaking in the Unity script, I was able to get the expected message into Unity.<br>I had to cut out a <code>getPipedData()</code> function, which sounds like it’s defeating the point.<br>However, the functionality is repeated exactly in the <code>Setup()</code> of the Unity script, which works.<br><img src="/Robotic-Telepresence/2016/12/01/Standalone-rosserial-application/Success.png" alt="The &quot;I am the one true server&quot; string was defined in the &#39;PipeDataSend&#39; Windows console application"><br><figure class="highlight cs"><figcaption><span>The part of PipeDataReceive.cs which was commented out</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getPipedData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="comment">//UnityEngine.Debug.Log("Thread Called - Start");</span></div><div class="line">	StreamString ss = <span class="keyword">new</span> StreamString(pipeClient);</div><div class="line">	UnityEngine.Debug.Log(ss.ReadString());</div><div class="line">	<span class="comment">//UnityEngine.Debug.Log("Thread Called - End");</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>I noticed afterwards that after Unity gets stuck, closing the console applications un-freezes Unity which returns with:</p>
<blockquote>
<p>OverflowException: Number overflow.<br>StreamString.ReadString() (at Assets/_Scripts/PipeDataReceive.cs:51)<br>PipeDataReceive.getPipedData() (at Assets/_Scripts/PipeDataReceive.cs:33)<br>PipeDataReceive.Update() (at Assets/_Scripts/PipeDataReceive.cs:27)</p>
</blockquote>
<p>I lowered the threads from 4 to 1.<br>I had missed the part about reading from and writing to a file for example purposes, so I stripped it out.<br>The <code>PipeDataSend</code> and <code>PipeDataReceive</code> files are about as short and compact as I can make them now.<br>They work well. The <code>PipeDataSend</code> waits for a connection. As soon as <code>PipeDataReceive</code> is started, <code>PipeDataSend</code> send over “Hello Unity!” and then finishes.<br>However, you must not stop the Unity game before the pipe server or it will crash…</p>
<p>Next step: See how this performs after integrating with <code>rosserial_windows</code> in Unity.<br><figure class="highlight cpp"><figcaption><span>PipeDataSend.cpp</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#using <span class="meta-string">&lt;System.Core.dll&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> System;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> System::IO;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> System::IO::Pipes;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> System::Text;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> System::Threading;</div><div class="line"></div><div class="line"><span class="keyword">public</span> ref <span class="keyword">class</span> StreamString &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">	Stream^ ioStream;</div><div class="line">	UnicodeEncoding^ streamEncoding;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">	StreamString(Stream^ ioStream) &#123;</div><div class="line">		<span class="keyword">this</span>-&gt;ioStream = ioStream;</div><div class="line">		streamEncoding = gcnew UnicodeEncoding();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	String^ ReadString() &#123;</div><div class="line">		<span class="keyword">int</span> len;</div><div class="line"></div><div class="line">		len = ioStream-&gt;ReadByte() * <span class="number">256</span>;</div><div class="line">		len += ioStream-&gt;ReadByte();</div><div class="line">		<span class="built_in">array</span>&lt;Byte&gt;^ inBuffer = gcnew <span class="built_in">array</span>&lt;Byte&gt;(len);</div><div class="line">		ioStream-&gt;Read(inBuffer, <span class="number">0</span>, len);</div><div class="line"></div><div class="line">		<span class="keyword">return</span> streamEncoding-&gt;GetString(inBuffer);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">WriteString</span><span class="params">(String^ outString)</span> </span>&#123;</div><div class="line">		<span class="built_in">array</span>&lt;Byte&gt;^ outBuffer = streamEncoding-&gt;GetBytes(outString);</div><div class="line">		<span class="keyword">int</span> len = outBuffer-&gt;Length;</div><div class="line">		<span class="keyword">if</span> (len &gt; UInt16::MaxValue)</div><div class="line">			len = (<span class="keyword">int</span>)UInt16::MaxValue;</div><div class="line">		ioStream-&gt;WriteByte((Byte)(len / <span class="number">256</span>));</div><div class="line">		ioStream-&gt;WriteByte((Byte)(len &amp; <span class="number">255</span>));</div><div class="line">		ioStream-&gt;Write(outBuffer, <span class="number">0</span>, len);</div><div class="line">		ioStream-&gt;Flush();</div><div class="line"></div><div class="line">		<span class="keyword">return</span> outBuffer-&gt;Length + <span class="number">2</span>;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">public</span> ref <span class="keyword">class</span> PipeServer &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span><span class="params">()</span> </span>&#123;</div><div class="line">		Console::WriteLine(<span class="string">"Pipe server started"</span>);</div><div class="line">		Console::WriteLine(<span class="string">"Waiting for client connection..."</span>);</div><div class="line">		Thread^ server = gcnew Thread(gcnew ThreadStart(&amp;ServerThread));</div><div class="line">		server-&gt;Start();</div><div class="line">		Thread::Sleep(<span class="number">250</span>);</div><div class="line">		<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</div><div class="line">			<span class="keyword">if</span> (server != <span class="literal">nullptr</span>) &#123;</div><div class="line">				<span class="comment">// Check if it has gone. If so, remove it.</span></div><div class="line">				<span class="keyword">if</span> (server-&gt;Join(<span class="number">250</span>)) &#123;</div><div class="line">					Console::WriteLine(<span class="string">"Server thread finished."</span>, server-&gt;ManagedThreadId);</div><div class="line">					server = <span class="literal">nullptr</span>;</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		Console::WriteLine(<span class="string">"Finished."</span>);</div><div class="line">	&#125;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ServerThread</span><span class="params">()</span> </span>&#123;</div><div class="line">		NamedPipeServerStream^ pipeServer = gcnew NamedPipeServerStream(<span class="string">"rospipe"</span>, PipeDirection::InOut);</div><div class="line"></div><div class="line">		<span class="comment">// Wait for a client to connect</span></div><div class="line">		pipeServer-&gt;WaitForConnection();</div><div class="line"></div><div class="line">		Console::WriteLine(<span class="string">"Client connected"</span>);</div><div class="line">		<span class="comment">// Do my data transfer here!</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			StreamString^ ss = gcnew StreamString(pipeServer);</div><div class="line"></div><div class="line">			ss-&gt;WriteString(<span class="string">"Hello Unity!"</span>);</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">catch</span> (IOException^ e) &#123;</div><div class="line">			Console::WriteLine(<span class="string">"ERROR: &#123;0&#125;"</span>, e-&gt;Message);</div><div class="line">		&#125;</div><div class="line">		pipeServer-&gt;Close();</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	PipeServer::Main();</div><div class="line">	Console::WriteLine(<span class="string">"\nPlease close this window."</span>);</div><div class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight cs"><figcaption><span>PipeDataReceive.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.IO;</div><div class="line"><span class="keyword">using</span> System.IO.Pipes;</div><div class="line"><span class="keyword">using</span> System.Threading;</div><div class="line"><span class="keyword">using</span> System.Text;</div><div class="line"><span class="keyword">using</span> System;</div><div class="line"><span class="keyword">using</span> System.Security.Principal;</div><div class="line"><span class="keyword">using</span> System.Diagnostics;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PipeDataReceive</span> : <span class="title">MonoBehaviour</span> &#123;</div><div class="line">	<span class="keyword">public</span> NamedPipeClientStream pipeClient = <span class="keyword">new</span> NamedPipeClientStream(<span class="string">"."</span>, <span class="string">"rospipe"</span>, PipeDirection.InOut, PipeOptions.Asynchronous);</div><div class="line">	<span class="keyword">public</span> StreamString ss;</div><div class="line">	Thread readThread;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		UnityEngine.Debug.Log(<span class="string">"Connecting to pipe server..."</span>);</div><div class="line">		pipeClient.Connect();</div><div class="line">		Thread.Sleep(<span class="number">250</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		getPipedData();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getPipedData</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		StreamString ss = <span class="keyword">new</span> StreamString(pipeClient);</div><div class="line">		UnityEngine.Debug.Log(<span class="string">"piped: "</span>+ss.ReadString());</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StreamString</span> &#123;</div><div class="line">	<span class="keyword">private</span> Stream ioStream;</div><div class="line">	<span class="keyword">private</span> UnicodeEncoding streamEncoding;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StreamString</span>(<span class="params">Stream ioStream</span>) </span>&#123;</div><div class="line">		<span class="keyword">this</span>.ioStream = ioStream;</div><div class="line">		streamEncoding = <span class="keyword">new</span> UnicodeEncoding();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">ReadString</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="keyword">int</span> len;</div><div class="line">		len = ioStream.ReadByte() * <span class="number">256</span>;</div><div class="line">		len += ioStream.ReadByte();</div><div class="line">		<span class="keyword">byte</span>[] inBuffer = <span class="keyword">new</span> <span class="keyword">byte</span>[len];</div><div class="line">		ioStream.Read(inBuffer, <span class="number">0</span>, len);</div><div class="line">		<span class="keyword">string</span> outString = streamEncoding.GetString(inBuffer);</div><div class="line"></div><div class="line">		<span class="keyword">return</span> outString;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">WriteString</span>(<span class="params"><span class="keyword">string</span> outString</span>) </span>&#123;</div><div class="line">		<span class="keyword">byte</span>[] outBuffer = streamEncoding.GetBytes(outString);</div><div class="line">		<span class="keyword">int</span> len = outBuffer.Length;</div><div class="line">		<span class="keyword">if</span> (len &gt; UInt16.MaxValue)</div><div class="line">			len = (<span class="keyword">int</span>)UInt16.MaxValue;</div><div class="line">		ioStream.WriteByte((<span class="keyword">byte</span>)(len / <span class="number">256</span>));</div><div class="line">		ioStream.WriteByte((<span class="keyword">byte</span>)(len &amp; <span class="number">255</span>));</div><div class="line">		ioStream.Write(outBuffer, <span class="number">0</span>, len);</div><div class="line">		ioStream.Flush();</div><div class="line"></div><div class="line">		<span class="keyword">return</span> outBuffer.Length + <span class="number">2</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/01/Data-to-Unity-from-RAM/" data-id="cizlhttac0008509ro7cz85vk" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/12/01/Project-meeting-6/">Project meeting 6</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/12/01/Project-meeting-6/" class="article-date">
  <time datetime="2016-12-01T16:57:35.000Z" itemprop="datePublished">Thu 01/12/2016 16:57</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h5 id="Discussion-about-the-previous-week’s-work"><a href="#Discussion-about-the-previous-week’s-work" class="headerlink" title="Discussion about the previous week’s work"></a>Discussion about the previous week’s work</h5><p>I tried to explain the problems I was having with <code>.dlls</code>.<br>I had some potentially useful tips about how to get them to work with arrays. I should look into <a href="https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.aspx" target="_blank" rel="external">marshal functions</a> and <a href="https://msdn.microsoft.com/en-us/library/04fy9ya1.aspx" target="_blank" rel="external">interop</a>.<br>To analyse the extent of ‘name mangling’, I can put the <code>.dll</code> through <a href="http://www.dependencywalker.com/" target="_blank" rel="external">Dependency Walker</a>.<br>I came across these in the past week, I think I should have more experience and knowledge with C# besides Unity scripting for this to be successful.</p>
<p>We have decided it would be much better to move away from compiling <code>.dlls</code> as Unity plugins, and instead use a compiled console application in Windows to receive the messages into RAM, and get Unity to poll the most recent values.<br>I have been talking to James, who is trying to implement UDP communication in Unity with ROS.</p>
<p>In terms of the networking layout, the VR PC will be subscribing directly from Baxter (who has an internal ROS publisher) and publishing to the linux computer connected to Baxter, which will be calculating the inverse kinematics from the hand target positions.<br>We thing a position and a pose is required for this, so I will need the quaternions of the rotations of each hand.<br>Unity works with quaternions so this doesn’t sound too much of a challenge, but to start with I might well fix the pose to have the hands facing forwards.</p>
<p>I wasn’t able to filter the joints that were in the public <code>urdf</code> and those in the <code>rosbag</code>. Maybe Baxter’s urdf is a previous verion?<br>I was also strange that the gripper messages were arriving separately.</p>
<h5 id="Interim-report"><a href="#Interim-report" class="headerlink" title="Interim report"></a>Interim report</h5><p>The same examiner(s) who marks this will mark the final dissertation.<br>Therefore, don’t commit to work which is unlikely to come to fruition. Light exaggeration could back me into a corner.<br>Also, there will be some overlap between the interim report and the final submission. They have to exist as separate entities, but maybe not a total copy.</p>
<p>I have two weeks left before Christmas. If I want any useful feedback (I do) I should have a report structure by <a href="/Robotic-Telepresence/2016/12/13/Project-meeting-7/">next meeting</a>.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/12/01/Project-meeting-6/" data-id="cizlhttb5000y509rhw6syp2b" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Rosbag-communication" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/28/Rosbag-communication/">Rosbag communication</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/28/Rosbag-communication/" class="article-date">
  <time datetime="2016-11-28T15:11:18.000Z" itemprop="datePublished">Mon 28/11/2016 15:11</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’ll be trying to get full rosbag communication into Unity, and communication in the other direction too.<br>Ideally this will be configurable inside Unity, I’m not sure how dynamic I can/need to make this.<br>The first step is to get virtual Baxter to move as the bag plays.</p>
<p>From the <a href="http://wiki.ros.org/Names" target="_blank" rel="external">documentation</a>, ROS topic names can be composed of the following characters: <code>0-9</code>, <code>a-z</code>, <code>A-Z</code>, <code>_</code>, <code>/</code>.<br>So long as I use a different delimiter in the message formatting for my Unity interface this won’t cause problems.<br>I’d like to keep this concise to minimize latency and parsing effort.<br>For now, I’m transmitting the names in the same order as they are in the bag (alphabetical) next to their values, separated with <code>=</code>.</p>
<p>I set up a post-build task to copy the resulting <code>.dll</code> to the <code>plugins/</code> folder in the Unity assets.<br>I’m still getting lots of ‘sync lost’ messages, one every second.<br>It may be something to do with <code>nh_spinOnce()</code>, but I should be calling it every Unity loop.<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[ WARN] [1480349686.965718293]: Sync with device lost.</div></pre></td></tr></table></figure></p>
<p>There doesn’t seem to be a whole lot of error checking.<br>For instance, trying to read an <code>int</code> return value from a <code>.dll</code> function which has a void return type happily works.<br>If the socket connection cannot be made, it’s easy to create a block which will not allow the Unity application to start, and it becomes unresponsive and has to be forced to quit.</p>
<p>The hard part is that the data from the <code>rosbag</code> is being received in a callback.<br>The way to get data out from the <code>.dll</code> and into Unity seems to be using return values from functions which are called in a Unity script.<br>I could make a set of variables which are updated with the most recent values.<br>This would be OK in the way that the model only has to be up to date and doesn’t need to show every position transmitted, except I would need to know the variables I am expecting before compiling the <code>.dll</code>.<br>Alternatively, I could preallocate a large number of variables to fill in, and the Unity client would know what is coming and in what order because of the imported robot <code>URDF</code>.<br>For now I will hard-code it and maybe ask in the project meeting.</p>
<p>I can’t pass strings out of the <code>.dll</code>. This seems to be misunderstanding <code>.dlls</code> or Unity.<br>I’m trying to think of a way to get the data out.<br>I could provide pointers to data from Unity into the <code>.dll</code> which match up with the subscription, but I still need a better callback.<br>At the end of <a href="http://wiki.ros.org/rosserial_windows/Tutorials/Receiving%20Messages" target="_blank" rel="external">this tutorial</a> it mentions:</p>
<blockquote>
<p>It’s possible to subclass the Subscriber class for a more object-oriented approach. In that case, instead of registering with the call back above simply instantiate the new class and pass that in to the subscribe call.</p>
</blockquote>
<p>This sounds more like what I want?<br>I’ll try with <code>rosserial_hello_world</code> first.<br>I’ve replaced all the <code>printf</code> functions with a better C++ approach (<code>cout</code> streams).</p>
<p>I couldn’t work out what the page meant.<br>I tried creating a dictionary of joints and angles in Unity and feeding that into the <code>.dll</code>, but I needed to ‘use’ <code>System.Collections.Generic</code> and I couldn’t work out how to do that either.<br>I managed to pass a string as an argument into a <code>.dll</code> function, by casting <code>char*</code>:<br><figure class="highlight cs"><figcaption><span>Unity script</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">[DllImport (<span class="string">"rosserial_unity"</span>)]</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">double</span> <span class="title">getValue</span>(<span class="params"><span class="keyword">string</span> key</span>)</span>;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><figcaption><span>dll code</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="function">DLLEXPORT <span class="keyword">double</span> <span class="title">getValue</span><span class="params">(<span class="keyword">char</span>* key)</span> </span>&#123;</div><div class="line">	<span class="keyword">if</span> ((<span class="built_in">string</span>)key == <span class="string">"head_pan"</span>)</div><div class="line">...</div></pre></td></tr></table></figure>
<p>Now I will go through the robot hierarchy in Unity, filter out the <code>GameObjects</code> which are tagged “URDF joints”, sort them alphabetically and then request their values from the socket stream.<br>Unfortunately, the list of <code>GameObjects</code> is much longer (48) than those contained within the stream (18), and I can’t differentiate.<br>I will either have to check one by one somehow or find out what makes the ones in the <code>rosbag</code> special.<br>I’ll just hard code it for now…<br>This is difficult too.<br>There is no pattern to the messages with 18 joints, or the ones which just contain a right or left gripper.</p>
<p>It’s pretty annoying having to restart Unity every time I’ve updated the <code>.dll</code>.</p>
<h4 id="Some-success"><a href="#Some-success" class="headerlink" title="Some success"></a>Some success</h4><p>I resorted to the most god-awful code, but I’ve finally got joint angles into Unity.<br>This will DEFINITELY need changing, but I can progress with making sure that I have the update rate etc.</p>
<p>I’ve managed to get <em>some</em> form of the ros bag onto virtual Baxter.<br>The ‘sync lost’ messages have stopped, I’m not sure why, because the update loop isn’t going much faster or slower than before.<br>I’ll have to set additional attributes to each link during the import to record which axis rotates, and the effort limits.</p>
<p>I’ve made a script with private variables for just axis to start with, and modified the import script to attach it to every joint.<br>I’ll also have to do the same to the origin values to keep a reference to them.<br>I also attach the <code>rosserial</code> script to the root by default.</p>
<p>After some playing around with rotations, I got it to work:<br><div class="video-container"><iframe src="//www.youtube.com/embed/0TW5gbRr-oQ" frameborder="0" allowfullscreen></iframe></div></p>
<p>The jerkiness can be down to many things:</p>
<ul>
<li>Only the most recent message is stored</li>
<li>If that message was a gripper, the rest of the values are empty</li>
<li>The messages are only read every Unity frame at the moment, probably 60FPS</li>
</ul>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/28/Rosbag-communication/" data-id="cizlhttbh001b509r2fcj6ra0" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Exploring-rosbags" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/23/Exploring-rosbags/">Exploring rosbags</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/23/Exploring-rosbags/" class="article-date">
  <time datetime="2016-11-23T23:02:48.000Z" itemprop="datePublished">Wed 23/11/2016 23:02</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>In the <a href="/Robotic-Telepresence/2016/11/22/Project-meeting-5/">last project meeting</a>, we recorded about 60 seconds worth of Baxter waving his arms around and saved it as a rosbag.<br>The uncompressed version is 8.5GB, and to view it in RViz for example will probably require it to be loaded into RAM.<br>Oscar recommended using a RAMdisk to speed things up.<br>Since I have <em>too much</em> RAM (64GB), I thought it would be easier to just put the whole Ubuntu virtual machine into the RAMdisk.</p>
<p>First, make sure roscore is running.<br>In each separate terminal, I remember I have to source the <code>workspace/devel/setup.zsh</code> file.<br><figure class="highlight zsh"><figcaption><span>Command line 1</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> ~/catkin_ws</div><div class="line">$ . ./devel/setup.zsh</div><div class="line">$ roscore</div></pre></td></tr></table></figure></p>
<p>From here, I can do<br><figure class="highlight zsh"><figcaption><span>Command line 2</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ rosbag info ~/Downloads/baxter.bag</div><div class="line">path:        /home/celynwalters/Downloads/baxter.bag</div><div class="line">version:     2.0</div><div class="line">duration:    1:03s (63s)</div><div class="line">start:       Nov 22 2016 16:49:25.44 (1479833365.44)</div><div class="line">end:         Nov 22 2016 16:50:28.49 (1479833428.49)</div><div class="line">size:        7.9 GB</div><div class="line">messages:    37025</div><div class="line">compression: none [866/866 chunks]</div><div class="line">types:       octomap_msgs/Octomap    [9a45536b45c5e409<span class="built_in">cd</span>49f04bb2d9999f]</div><div class="line">             sensor_msgs/JointState  [3066dcd76a6cfaef579bd0f34173e9fd]</div><div class="line">             sensor_msgs/PointCloud2 [1158d486dd51d683ce2f1be655c3c181]</div><div class="line">             tf2_msgs/TFMessage      [94810edda583a504dfda3829e70d7eec]</div><div class="line">topics:      /camera/depth_registered/points     865 msgs    : sensor_msgs/PointCloud2</div><div class="line">             /octomap_full                        55 msgs    : octomap_msgs/Octomap   </div><div class="line">             /robot/joint_states               24149 msgs    : sensor_msgs/JointState  (2 connections)</div><div class="line">             /tf                               11954 msgs    : tf2_msgs/TFMessage      (7 connections)</div><div class="line">             /tf_static                            2 msgs    : tf2_msgs/TFMessage      (2 connections)</div></pre></td></tr></table></figure></p>
<p>Great, I can see all of the ROS topics it contains.<br>I know from my <code>rosserial</code> experiments that I can listen to a topic using <code>rostopic echo</code> even if it isn’t visible yet.<br>In a separate shell I did this for the joint angles as this is the ‘easiest’ to integrate into Unity for now.<br><figure class="highlight zsh"><figcaption><span>Command line 3</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rostopic <span class="built_in">echo</span> /robot/joint_states</div></pre></td></tr></table></figure></p>
<p>Back in this shell, I played back the bag:<br><figure class="highlight zsh"><figcaption><span>Command line 2</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ rosbag play ~/Downloads/baxter.bag</div><div class="line">[ INFO] [1479942083.502475169]: Opening /home/celynwalters/Downloads/baxter.bag</div><div class="line"></div><div class="line">Waiting 0.2 seconds after advertising topics... done.</div><div class="line"></div><div class="line">Hit space to toggle paused, or <span class="string">'s'</span> to step.</div><div class="line"> [RUNNING]  Bag Time: 1479833369.512015   Duration: 4.075116 / 63.055731</div></pre></td></tr></table></figure></p>
<p>This gives a very fast output of each frame for each topic:<br><figure class="highlight zsh"><figcaption><span>Command line 3</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">header: </div><div class="line">  seq: 387581</div><div class="line">  stamp: </div><div class="line">    secs: 1479833365</div><div class="line">    nsecs: 441285362</div><div class="line">  frame_id: <span class="string">''</span></div><div class="line">name: [<span class="string">'head_nod'</span>, <span class="string">'head_pan'</span>, <span class="string">'left_e0'</span>, <span class="string">'left_e1'</span>, <span class="string">'left_s0'</span>, <span class="string">'left_s1'</span>, <span class="string">'left_w0'</span>, <span class="string">'left_w1'</span>, <span class="string">'left_w2'</span>, <span class="string">'right_e0'</span>, <span class="string">'right_e1'</span>, <span class="string">'right_s0'</span>, <span class="string">'right_s1'</span>, <span class="string">'right_w0'</span>, <span class="string">'right_w1'</span>, <span class="string">'right_w2'</span>, <span class="string">'torso_t0'</span>]</div><div class="line">position: [0.0, 0.03029612056073692, -1.405126401703039, 1.2931458041874038, -0.04832039481839053, 0.030679615757708275, 1.5991749713705439, 1.3537380453088776, -0.4636456931383663, 1.647111870991963, 1.5945730290068876, -0.18676216092504913, 0.13537380453088776, -1.5872866202644318, 1.491029325824622, -0.9004467224887379, -12.565987119160338]</div><div class="line">velocity: [0.0, 0.003926990816250607, -0.009817477040626518, -0.005497787142750851, -0.005890486224375911, -0.00510508806112579, -0.012959069693627005, 0.003926990816250607, -0.01021017612225158, 0.011780972448751823, 0.01649336142825255, 0.0007853981632501215, 0.023561944897503646, -0.009032078877376396, -0.01531526418337737, -0.009817477040626518, 0.0]</div><div class="line">effort: [0.0, 0.0, -18.58, -0.312, 0.216, -7.88, 0.896, 0.2, 0.14, 21.096, 1.26, 1.088, -4.268, 0.828, -0.052, -0.036, -20.48]</div><div class="line">---</div><div class="line">header: </div><div class="line">  seq: 387582</div><div class="line">  stamp: </div><div class="line">    secs: 1479833365</div><div class="line">    nsecs: 451285944</div><div class="line">  frame_id: <span class="string">''</span></div><div class="line">name: [<span class="string">'head_nod'</span>, <span class="string">'head_pan'</span>, <span class="string">'left_e0'</span>, <span class="string">'left_e1'</span>, <span class="string">'left_s0'</span>, <span class="string">'left_s1'</span>, <span class="string">'left_w0'</span>, <span class="string">'left_w1'</span>, <span class="string">'left_w2'</span>, <span class="string">'right_e0'</span>, <span class="string">'right_e1'</span>, <span class="string">'right_s0'</span>, <span class="string">'right_s1'</span>, <span class="string">'right_w0'</span>, <span class="string">'right_w1'</span>, <span class="string">'right_w2'</span>, <span class="string">'torso_t0'</span>]</div><div class="line">position: [0.0, 0.03029612056073692, -1.4043594113090963, 1.2931458041874038, -0.04793689962141918, 0.03106311095467963, 1.5991749713705439, 1.3537380453088776, -0.464412683532309, 1.6455778902040776, 1.5934225434159734, -0.18561167533413506, 0.1357572997278591, -1.5869031250674606, 1.491029325824622, -0.9004467224887379, -12.565987119160338]</div><div class="line">velocity: [0.0, -0.0047123889795007284, 0.010995574285501701, 0.02120575040775328, -0.003926990816250607, 0.01688606050987761, -0.001570796326500243, -0.00039269908162506076, 0.006675884387626033, 0.014529866020127248, -0.006283185306000972, 0.01649336142825255, 0.02552544030562895, -0.0047123889795007284, 0.023169245815878585, 0.01021017612225158, 0.0]</div><div class="line">effort: [0.0, 0.0, -18.42, -0.248, 0.404, -7.912, 0.924, 0.216, 0.128, 20.932, 1.228, 1.184, -4.368, 0.816, -0.064, -0.028, -20.48]</div><div class="line">---</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>I’m going to adapt the <code>rosserial_hello_world</code> code to subscribe instead of publish.<br>The <a href="http://wiki.ros.org/rosserial/Overview/Publishers%20and%20Subscribers" target="_blank" rel="external">documentation</a> says that you need to include the header file for the sort of message you want to use.<br>Thankfully, the built <code>lib/</code> folder on the windows side includes baxter’s message descriptions.<br>You then “create a function that returns void and takes a constant reference of your message type as its argument”.<br>“Then to actually setup the connection we have to create a statically allocated ros::Subscriber which is templated on your message type and call NodeHandle::subscribe within the setup() function”<br>Sounds easy enough…</p>
<p>After I spent ages trying to make sense of the <code>baxter_core_msgs/JointCommand.h</code> header file, I eventually found out which messages to use.<br>To find out, play the <code>rosbag</code>, and in another shell do:<br><figure class="highlight zsh"><figcaption><span>Command line 3</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ rostopic list -v</div><div class="line"></div><div class="line">Published topics:</div><div class="line"> * /robot/joint_states [sensor_msgs/JointState] 1 publisher</div><div class="line"> * /camera/depth_registered/points [sensor_msgs/PointCloud2] 1 publisher</div><div class="line"> * /octomap_full [octomap_msgs/Octomap] 1 publisher</div><div class="line"> * /rosout [rosgraph_msgs/Log] 1 publisher</div><div class="line"> * /tf [tf2_msgs/TFMessage] 1 publisher</div><div class="line"> * /tf_static [tf2_msgs/TFMessage] 1 publisher</div><div class="line"> * /clock [rosgraph_msgs/Clock] 1 publisher</div><div class="line"> * /rosout_agg [rosgraph_msgs/Log] 1 publisher</div><div class="line"></div><div class="line">Subscribed topics:</div><div class="line"> * /rosout [rosgraph_msgs/Log] 1 subscriber</div></pre></td></tr></table></figure></p>
<p>So actually, the joint angles use the <code>sensor_msgs/JointState</code> message,<br>I had to move some lines around, correct some typos, syntax errors etc. etc.<br>I wasn’t sure about printing actual joint angles yet, but I know I can print <code>position_length</code>, which presumably means how many joint positions there are.</p>
<p>It worked! The screenshot (often…) shows there are 17 angles. This almost definitely corresponds to:</p>
<ul>
<li>14 arm joints (2x7)</li>
<li>2 head joints</li>
<li>1 torso joint</li>
</ul>
<p><img src="/Robotic-Telepresence/2016/11/23/Exploring-rosbags/Subscriber.png" alt="Left side is Ubuntu running ROS playing the Baxter rosbag, right side is Windows subscribing to it"><br>With a little more tweaking, and it’s actually pretty easy!<br>I can pull the names out and format it in any way I choose to suit my Unity needs.</p>
<p><img src="/Robotic-Telepresence/2016/11/23/Exploring-rosbags/Named.png" alt="The &#39;1&#39; position_length messages are revealed to be for the grippers"></p>
<p>Next stop, compiling this code into the Unity <code>.dll</code>, and then getting the joints to mirror the <code>rosbag</code>.<br>NICE.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/23/Exploring-rosbags/" data-id="cizlhttab0007509rlmhf1neo" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/22/Project-meeting-5/">Project meeting 5</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/22/Project-meeting-5/" class="article-date">
  <time datetime="2016-11-22T23:02:04.000Z" itemprop="datePublished">Tue 22/11/2016 23:02</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’m definitely working on the right track, but whenever I get asked specifics about my plans I come up blank.<br>It’s becoming increasingly clear that I need to update my Gantt chart! This will be done by next week I swear.</p>
<p>I learned about the octree.<br>While the kinect only has a line-of-sight view of the world, the octree retains data of geometry which is obstructed.<br>This geometry can only be removed if it is confirmed to not be there anymore, at which point its probability of being there is lowered gradually.</p>
<p>I filled out the health and safety forms for Baxter and the robot lab.<br>I should be able to go in and get some real experience with <code>ROS</code>.<br>(My swipe access might work now as well)</p>
<p>The most useful thing for me to do now would be to see if I could get specific communication using <code>rosserial</code>, not just general Boolean confirmation that it’s happening.<br>We recorded Baxter waving his arms around for about 60 seconds.<br>This data was compiled into a <code>rosbag</code>, which supposedly can be swapped out for real data being streamed from Baxter with very little changes experienced.<br>In this <code>rosbag</code> we included:</p>
<ul>
<li>The joint angles.<br>This should plug in to the Unity project because I already have the URDF and virtual representation</li>
<li>The point cloud data from the Kinect<br>I don’t know how to do this yet, but there has got to be ways to do it, I’m not too worried.</li>
<li>The octrees<br>I’ll have to think about this, but I’m sure it will be possible somehow.<br>To use the <code>rosbags</code>, you can do<figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rosbag (record | play) baxter.bag</div></pre></td></tr></table></figure>
</li>
</ul>
<p>It plays back in RViz fine. Lasts about 60 seconds.<br>We confirmed its integrity by transferring it to another computer and directly playing it back to Baxter.<br>Oscar will send me a dropbox link with the rosbag, it is quite large (~8.5GB) and we had trouble putting it on a USB stick (possibly because of the 4GB Fat32 filesize limit?)<br>Apparently a RAMdisk might be helpful for the rosbag.<br>If I need to translate coordinate frames relative to Baxter, the frame is ‘base’”?<br>I knew I wouldn’t remember everything but I know these things exist to ask about.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/22/Project-meeting-5/" data-id="cizlhttb7000z509ru7vlakvj" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-ROS-serial-Unity-plugin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/21/ROS-serial-Unity-plugin/">ROS serial: Unity plugin</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/21/ROS-serial-Unity-plugin/" class="article-date">
  <time datetime="2016-11-21T21:04:48.000Z" itemprop="datePublished">Mon 21/11/2016 21:04</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Unity managed plugins.<br>Create ‘Plugins’ folder in Unity assets, and put <code>.dll</code> files in there.<br>Try to compile <code>rosserial_hello_world</code> as a <code>.dll</code>?</p>
<p>(Be careful with name mangling!?)</p>
<p>Create new empty project, Win32 DLL.<br>Add new <code>.cpp</code> file, <code>main.cpp</code>.<br>Put some code in:<br><figure class="highlight cpp"><figcaption><span>main.cpp (rosserial_hello_world)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DLLEXPORT __declspec (dllexport)</span></div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line">	<span class="function">DLLEXPORT <span class="keyword">int</span> <span class="title">GetRandom</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> rand();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Write a script in Unity and attach it to a <code>GameObject</code>.<br>In the script, call the function from the DLL:<br><figure class="highlight cs"><figcaption><span>TestNative.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Runtime.InteropServices; <span class="comment">//For DLLImport</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestNative</span> : <span class="title">MonoBehaviour</span> &#123;</div><div class="line">	[DllImport (<span class="string">"rosserial_unity"</span>)]</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">GetRandom</span>(<span class="params"></span>)</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		print(<span class="string">"Native random number: "</span>+GetRandom());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Run the scene.<br>I got a few errors, but the main one was:<br><figure class="highlight plain"><figcaption><span>Unity console</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Failed to load &apos;Assets/Plugins/rosserial_unity.dll&apos;, expected 64 bit architecture (IMAGE_FILE_MACHINE_AMD64), but was IMAGE_FILE_MACHINE_I386. You must recompile your plugin for 64 bit architecture.</div></pre></td></tr></table></figure></p>
<p>Simple, will recompile.<br>It worked!<br><img src="/Robotic-Telepresence/2016/11/21/ROS-serial-Unity-plugin/Random Number.png" alt="The output from the .dll in Unity"></p>
<p>Now. Copy the <code>ros_lib</code> folder generated from <code>rosserial_windows</code> (<a href="/Robotic-Telepresence/2016/11/21/ROS-serial/">this post</a>) into the Visual Studio project folder.<br>Add them to the project as before.<br>I also had to add <code>stdafx.cpp</code>, <code>stdafx.h</code> and <code>targetver.h</code> as they were missing. I’m not sure I need them, they were generated by Visual Studio for the console application.<br>The build succeeds with all the includes from the generated <code>rosserial_hello_world</code> code.</p>
<p>Splitting the original code into functions, and making the scope of created objects also allows compilation.<br><figure class="highlight cpp"><figcaption><span>main.cpp (rosserial_unity)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdafx.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ros.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DLLEXPORT __declspec (dllexport)</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">string</span>;</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</div><div class="line">	ros::NodeHandle nh;</div><div class="line">	geometry_msgs::Twist twist_msg;</div><div class="line">	ros::<span class="function">Publisher <span class="title">cmd_vel_pub</span><span class="params">(<span class="string">"cmd_vel"</span>, &amp;twist_msg)</span></span>;</div><div class="line"></div><div class="line">	<span class="function">DLLEXPORT <span class="keyword">void</span> <span class="title">Connect</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">char</span> *ros_master = <span class="string">"192.168.0.31"</span>;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Connecting to server at %s\n"</span>, ros_master);</div><div class="line">		nh.initNode(ros_master);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function">DLLEXPORT <span class="keyword">void</span> <span class="title">Advertise</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Advertising cmd_vel message\n"</span>);</div><div class="line">		<span class="comment">// geometry_msgs::Twist twist_msg;</span></div><div class="line">		<span class="comment">// ros::Publisher cmd_vel_pub("cmd_vel", &amp;twist_msg);</span></div><div class="line">		nh.advertise(cmd_vel_pub);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Go robot go!\n"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function">DLLEXPORT <span class="keyword">void</span> <span class="title">Print</span><span class="params">()</span> </span>&#123;</div><div class="line">		twist_msg.linear.x = <span class="number">5.1</span>;</div><div class="line">		twist_msg.linear.y = <span class="number">0</span>;</div><div class="line">		twist_msg.linear.z = <span class="number">0</span>;</div><div class="line">		twist_msg.angular.x = <span class="number">0</span>;</div><div class="line">		twist_msg.angular.y = <span class="number">0</span>;</div><div class="line">		twist_msg.angular.z = <span class="number">-1.8</span>;</div><div class="line">		cmd_vel_pub.publish(&amp;twist_msg);</div><div class="line"></div><div class="line">		nh.spinOnce();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>I made a Unity script, changed from the <code>TestNative.cs</code> script to accomodate the new functions and implement a while loop.<br>This should hopefully do near enough the same thing as the original <code>rosserial_hello_world</code> script.<br><figure class="highlight cs"><figcaption><span>rosserial.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Runtime.InteropServices; <span class="comment">//For DLLImport</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">rosserial</span> : <span class="title">MonoBehaviour</span> &#123;</div><div class="line">	[DllImport (<span class="string">"rosserial_unity"</span>)]</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">Connect</span>(<span class="params"></span>)</span>;</div><div class="line">	[DllImport (<span class="string">"rosserial_unity"</span>)]</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">Advertise</span>(<span class="params"></span>)</span>;</div><div class="line">	[DllImport (<span class="string">"rosserial_unity"</span>)]</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">Print</span>(<span class="params"></span>)</span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		Connect();</div><div class="line">		Advertise();</div><div class="line">		<span class="keyword">while</span>(<span class="literal">true</span>) &#123;</div><div class="line">			Print();</div><div class="line">			System.Threading.Thread.Sleep(<span class="number">1000</span>); <span class="comment">//This is bad but I'm just testing</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>This causes Unity to freeze, requiring a force quit with the Task Manager.<br>The play button is still depressed but not active, as if it’s preparing to start.<br>HOWEVER, in the virtual machine, we get the output!<br><img src="/Robotic-Telepresence/2016/11/21/ROS-serial-Unity-plugin/Success.png" alt="Before the game was running, only up to the &quot;Listening on port 11411&quot; was visible. The output on the right is being streamed in."><br>Moving code to the <code>Update()</code> loop, and commenting out the functions still keeps causing Unity to hang.<br>The fix turned out to be simple.<br>We don’t need a while loop in <code>Start()</code>, or in <code>Update()</code>. The <code>Update()</code> function is already a loop.<br>I set it to only <code>Print()</code> when the x component of the translation of Baxter’s torso changed.<br>After connecting, the socket node complained every second about some desynchronisation:<br><figure class="highlight plain"><figcaption><span>Console output (excerpt)</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[WARN] [1479767182.854363980]: Sync with device lost.</div></pre></td></tr></table></figure></p>
<p>As soon as I moved baxter, it stopped.</p>
<p>Next step: Replace the dummy data with actual values!</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/21/ROS-serial-Unity-plugin/" data-id="cizlhttbe0018509rj4xfeg5u" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-ROS-serial" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/21/ROS-serial/">ROS serial</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/21/ROS-serial/" class="article-date">
  <time datetime="2016-11-21T13:03:18.000Z" itemprop="datePublished">Mon 21/11/2016 13:03</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Following the instructions <a href="http://wiki.ros.org/rosserial_windows/Tutorials/Hello%20World" target="_blank" rel="external">here</a> with a few edits.<br><code>apt</code> can mostly replace <code>apt-get</code> now, and I’m using version indigo, not hydro.</p>
<p>Install rosserial_windows:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt install ros-indigo-rosserial-windows ros-indigo-rosserial-server</div></pre></td></tr></table></figure></p>
<p>Make sure I’ve set up the environment:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> ~/catkin_ws</div><div class="line">$ . devel/setup.zsh</div></pre></td></tr></table></figure></p>
<p>Generate ros_lib:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rosrun rosserial_windows make_libraries.py my_library</div></pre></td></tr></table></figure></p>
<p>I couldn’t run this, rosserial wasn’t coming up in the tab completion for rosrun.<br>Refreshing the tree fixed it:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ rospack profile</div></pre></td></tr></table></figure></p>
<p>After running the installer, it failed giving the following message:<br><figure class="highlight plain"><figcaption><span>rosrun output</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">*** Warning, failed to generate libraries for the following packages: ***</div><div class="line">    baxter_sim_kinematics (missing dependency)</div><div class="line">    pr2_description (missing dependency)</div></pre></td></tr></table></figure></p>
<p>Installing them:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt install ros-indigo-baxter-sim-kinematics ros-indigo-pr2-description</div></pre></td></tr></table></figure></p>
<p>ros-indigo-pr2-description was already installed…<br>So it wasn’t surprising when this installation didn’t help<br>Checking dependencies didn’t help:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ rosdep check --from-paths ./src -ignore-src</div><div class="line">All system dependencies have been satisfied</div></pre></td></tr></table></figure></p>
<p>It turns out that there were more dependencies to install:<br><figure class="highlight zsh"><figcaption><span>Command line</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt install ros-indigo-moveit-resources ros-indigo-convex-decomposition</div></pre></td></tr></table></figure></p>
<p>This solved the <code>baxter-sim-kinematics</code> error.<br>After installing <code>ros-indigo-ivcon</code> it exited successfully.</p>
<p>In Windows, I created a new Console Application in Visual Studio.<br>Copied the generated folder to the project folder.<br>Added the files not in their own folders to the project.<br>Then I added the folder to the additional includes list.<br>After copying the ‘hello world’ code, it build and began running, listening on <code>1.2.3.4</code>.</p>
<p>As at this point I was running Xubuntu and ROS in a virtual machine, I tried to see if I could contact it.<br>I had to change the virtual machine’s network settings from NAT ro Bridged adaptor.<br>After a reboot, I could ping it at the new address.<br>I changed the <code>ros_master</code> to the new address.<br>In the guest system, I ran three terminals as the instructions said to start the server.</p>
<p>I got a response in the built program!<br><img src="/Robotic-Telepresence/2016/11/21/ROS-serial/Visual Studio.png" alt="hello_world running on Windows"><br>I also got the correct output in the virtual machine:<br><img src="/Robotic-Telepresence/2016/11/21/ROS-serial/Terminal.png" alt="rostopic echo /cmd_vel"></p>
<p>I’d like to try and get this to work within the Unity project.<br>This might be a little difficult, as I’m using C# in Unity, but I haven’t done the research yet.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/21/ROS-serial/" data-id="cizlhttba0013509rqpq4bthv" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/15/Project-meeting-4/">Project meeting 4</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/15/Project-meeting-4/" class="article-date">
  <time datetime="2016-11-15T19:46:17.000Z" itemprop="datePublished">Tue 15/11/2016 19:46</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h3 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps"></a>Next steps</h3><p>The next step to do is to try and animate Baxter.<br>We’ll try and get some recorded motion from Baxter to replay as if it was being transmitted live.<br>Apparently the joint positions etc. are just smooshed together in a text file (not like the <code>urdf</code>, but the joint and link names will be consistent).<br>To get rosserial_windows working:</p>
<ul>
<li>Install packages in Linux (Ubuntu 14)</li>
<li>Generate C# code</li>
<li>Compile in Windows (or use in Unity..?)</li>
<li>Run executable</li>
</ul>
<h3 id="Inverse-kinematics-IK"><a href="#Inverse-kinematics-IK" class="headerlink" title="Inverse kinematics (IK)"></a>Inverse kinematics (IK)</h3><p>Baxter has an IK solver for working out joint positions based on an end effector position.<br>Unity probably has some similar functionality, it’s common to want to animate boned meshes.<br>If it’s feasible, I think it would be prefereble to use Baxter’s solutions for this.<br>There can be multiple solutions for solving inverse kinematics.<br>If it makes a difference, Baxter’s internal results could be more predictable/reliable.<br>It might also only require the data for the end effector position to be sent to Baxter rather than the whole arm.<br>The user would to move Baxter’s hand with a Vive wand and request an attempt to move to that position.<br>I wonder what happens if you attempt to move to an impossible position outside of the movement limits.</p>
<p>Also, fill out the Health and Safety form for the Robot Lab.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/15/Project-meeting-4/" data-id="cizlhttb3000v509rbgroup1y" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Baxter-imported" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/14/Baxter-imported/">Baxter imported</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/14/Baxter-imported/" class="article-date">
  <time datetime="2016-11-14T23:39:32.000Z" itemprop="datePublished">Mon 14/11/2016 23:39</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>To import the meshes, I first tried to add new mesh filter and mesh renderer components to the created GameObjects.<br>Unfortunately, this doesn’t add the materials like it does when you drag them in, and I can’t seem to find an easy way to do add multiple, let alone choose the correct ones.<br>If a mesh had too many trianlges and was split into two, you also can’t attach both of them to the mesh filter, or attach two mesh filters to a <code>GameObject</code>.</p>
<p>I managed to find out how to import them in a nice(ish) way:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">string</span> path = meshNode.Attributes[<span class="string">"filename"</span>].Value;</div><div class="line">System.Uri uri = <span class="keyword">new</span> System.Uri(path);</div><div class="line">path = uri.Host + uri.PathAndQuery; <span class="comment">//Removes "package://"</span></div><div class="line">obj = GameObject.Instantiate(AssetDatabase.LoadAssetAtPath(<span class="string">"Assets/"</span>+path, <span class="keyword">typeof</span>(GameObject))) <span class="keyword">as</span> GameObject;</div></pre></td></tr></table></figure>
<p>This keeps the extra GameObjects such as Camera, Light and the Animation component.<br>The meshes are also children of each ‘URDF_link’ <code>GameObject</code> rather that acting as them.<br>You cannot easily copy the components (mesh filter, mesh renderer) to another object.<br>Even copying the only values would be a hassle.<br>The easiest was swapping the <code>GameObjects</code> around<br>The transformations and modifications would be applied afterwards.</p>
<p><img src="/Robotic-Telepresence/2016/11/14/Baxter-imported/Baxter.png" alt="Baxter at &#39;position zero&#39;"></p>
<p>To run the code, you only have to drag the robot package into the assets window, and the robot is automatically added to the scene.<br>In the end, it might be better if this was saved as a <code>PreFab</code> and not added to the scene.<br>The body looks hollow because the second mesh part was not automatically imported.<br>There are still problems with multiple mesh parts, where the <code>.urdf</code> and the <code>.urdf.xacro</code> are both being parsed.</p>
<p><img src="/Robotic-Telepresence/2016/11/14/Baxter-imported/Hierarchy.png" alt="Showing the generated hierarchy. Some of the transformations have rounding errors."></p>
<p>I wanted to try it out on some other robots, but most the ones I could get my hands on did not contain <code>.DAE</code> files, only <code>.STL</code> files which aren’t supported by Unity.<br>Fortuantely, ROS provides a <a href="http://wiki.ros.org/collada_urdf" target="_blank" rel="external">converter</a>.</p>
<blockquote>
<p>To be continued</p>
</blockquote>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/14/Baxter-imported/" data-id="cizlhtt9y0002509rkstnlbap" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-URDF-importer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/14/URDF-importer/">URDF importer</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/14/URDF-importer/" class="article-date">
  <time datetime="2016-11-14T00:09:35.000Z" itemprop="datePublished">Mon 14/11/2016 00:09</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Most robot repositories should have a repository with a robot description folder.<br>In Baxter’s case, this is <code>baxter_description</code>. It countains the <code>urdf</code> files and the mesh files.<br>By dragging this folder into the Unity Assets for a project, the importer script will automatically pick up the urdf files and filter down to the relevant one.<br>From here it can browse to the path of the meshes as the paths should match the existing directory layout.</p>
<p>The updated script is able to produce the hierarchy of joints and links with their respective transforms.<br>It uses a pair of functions that alternate and recurse with each other until the ends of the hierarchy are met, creating links and joints.<br><figure class="highlight cs"><figcaption><span>udrfPostProcessor.cs excerpt, updated</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseURDF</span>(<span class="params"><span class="keyword">string</span> filename</span>) </span>&#123;</div><div class="line">		<span class="comment">//Load file</span></div><div class="line">		<span class="keyword">var</span> xmlData = <span class="keyword">new</span> XmlDocument();</div><div class="line">		xmlData.Load(filename);</div><div class="line">		<span class="comment">//Set root node</span></div><div class="line">		XmlNode rootNode = xmlData.DocumentElement;</div><div class="line">		<span class="keyword">string</span> name = rootNode.Attributes[<span class="string">"name"</span>].Value;</div><div class="line">		GameObject rootObj = <span class="keyword">new</span> GameObject(name);</div><div class="line">		rootObj.tag = <span class="string">"URDF link"</span>;</div><div class="line">		<span class="comment">//Start recursive alternating functions to reach bottom of hierarchy</span></div><div class="line">		XmlNodeList joints = rootNode.SelectNodes(<span class="string">"joint/parent[@link='base']"</span>);</div><div class="line">		<span class="keyword">foreach</span> (XmlNode jointNode <span class="keyword">in</span> joints)</div><div class="line">			generateJoint(jointNode, rootObj, rootNode);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generateJoint</span>(<span class="params">XmlNode node, GameObject parentObj, XmlNode rootNode</span>) </span>&#123;</div><div class="line">		<span class="comment">//Create joint</span></div><div class="line">		node = node.ParentNode;</div><div class="line">		<span class="keyword">string</span> name = node.Attributes[<span class="string">"name"</span>].Value;</div><div class="line">		GameObject obj = <span class="keyword">new</span> GameObject(name);</div><div class="line">		obj.transform.parent = parentObj.transform;</div><div class="line">		obj.tag = <span class="string">"URDF joint"</span>;</div><div class="line">		<span class="comment">//Get origin rotation and translation parameters</span></div><div class="line">		getOrigin(node.SelectSingleNode(<span class="string">"origin"</span>), obj);</div><div class="line">		<span class="comment">//Find the child link</span></div><div class="line">		Debug.Log(node.SelectSingleNode(<span class="string">"child"</span>).Attributes[<span class="string">"link"</span>].Value);</div><div class="line">		XmlNode link = rootNode.SelectSingleNode(<span class="string">"link[@name='"</span>+node.SelectSingleNode(<span class="string">"child"</span>).Attributes[<span class="string">"link"</span>].Value+<span class="string">"']"</span>);</div><div class="line">		generateLink(link, obj, rootNode);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generateLink</span>(<span class="params">XmlNode node, GameObject parentObj, XmlNode rootNode</span>) </span>&#123;</div><div class="line">		<span class="comment">//Create link</span></div><div class="line">		<span class="keyword">string</span> name = node.Attributes[<span class="string">"name"</span>].Value;</div><div class="line">		GameObject obj = <span class="keyword">new</span> GameObject(name);</div><div class="line">		obj.transform.parent = parentObj.transform;</div><div class="line">		obj.tag = <span class="string">"URDF link"</span>;</div><div class="line">		<span class="comment">//Get origin rotation and translation parameters</span></div><div class="line">		XmlNode originNode = node.SelectSingleNode(<span class="string">"visual/origin"</span>);</div><div class="line">		<span class="keyword">if</span> (originNode != <span class="literal">null</span>) <span class="comment">//Not all links have a visual node</span></div><div class="line">			getOrigin(originNode, obj);</div><div class="line">		<span class="comment">//Find all joints who have this link as a parent</span></div><div class="line">		XmlNodeList joints = rootNode.SelectNodes(<span class="string">"joint/parent[@link='"</span>+name+<span class="string">"']"</span>);</div><div class="line">		<span class="keyword">foreach</span> (XmlNode jointNode <span class="keyword">in</span> joints)</div><div class="line">			generateJoint(jointNode, obj, rootNode);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getOrigin</span>(<span class="params">XmlNode node, GameObject obj</span>) </span>&#123;</div><div class="line">		<span class="comment">//Parse for translation</span></div><div class="line">		<span class="keyword">string</span>[] xyzStr = node.Attributes[<span class="string">"xyz"</span>].Value.Split(<span class="string">' '</span>);</div><div class="line">		Vector3 locations = <span class="keyword">new</span> Vector3();</div><div class="line">		locations.x = <span class="keyword">float</span>.Parse(xyzStr[<span class="number">0</span>]);</div><div class="line">		locations.y = <span class="keyword">float</span>.Parse(xyzStr[<span class="number">1</span>]);</div><div class="line">		locations.z = <span class="keyword">float</span>.Parse(xyzStr[<span class="number">2</span>]);</div><div class="line">		<span class="comment">//Parse for rotation</span></div><div class="line">		<span class="keyword">string</span>[] rpyStr = node.Attributes[<span class="string">"rpy"</span>].Value.Split(<span class="string">' '</span>);</div><div class="line">		Vector3 angles = <span class="keyword">new</span> Vector3();</div><div class="line">		angles.x = <span class="keyword">float</span>.Parse(rpyStr[<span class="number">0</span>]); <span class="comment">//r</span></div><div class="line">		angles.y = <span class="keyword">float</span>.Parse(rpyStr[<span class="number">1</span>]); <span class="comment">//p</span></div><div class="line">		angles.z = <span class="keyword">float</span>.Parse(rpyStr[<span class="number">2</span>]); <span class="comment">//y</span></div><div class="line">		angles = angles * Mathf.Rad2Deg;</div><div class="line">		<span class="comment">//Apply Transform</span></div><div class="line">		obj.transform.Translate(-locations.x, locations.y, locations.z);</div><div class="line">		obj.transform.Rotate(<span class="number">0</span>, <span class="number">0</span>, -angles.z, Space.Self);</div><div class="line">		obj.transform.Rotate(<span class="number">0</span>, -angles.y, <span class="number">0</span>, Space.Self);</div><div class="line">		obj.transform.Rotate(angles.x, <span class="number">0</span>, <span class="number">0</span>, Space.Self);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>An annoying run-time error which got me for a while was that a trailing slash can cause the XML parser to reach the end of the file unexpectedly.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node.SelectSingleNode(<span class="string">"visual/geometry/mesh/"</span>);</div></pre></td></tr></table></figure></p>
<p>Unfortunately, adding meshes directly using scripting loses out in some of the extra functionality that goes on behind the scenes when you drag an asset into the scene.<br>Creating a mesh renderer and a mesh filter via a script for the GameObjects is possible, but attached models are bright pink (no assigned texture).<br>When you drag an asset to instantiate it, Unity knows which materials to assign (which have been automativally generated).<br>Perhaps an easier way would be to emulate this action, and then delete any superfluous components?<br>It also doesn’t handle meshes which have been split for having too many vertices very well (i.e. the torso).</p>
<p>There’s still scope for the other parameters, such as movement limits, collision geometry, primitive shapes in place of models, and so on.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/14/URDF-importer/" data-id="cizlhttbx001i509res6rsplo" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Importing-directly-from-URDF" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/13/Importing-directly-from-URDF/">Importing directly from URDF</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/13/Importing-directly-from-URDF/" class="article-date">
  <time datetime="2016-11-13T18:28:59.000Z" itemprop="datePublished">Sun 13/11/2016 18:28</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>The <code>urdf</code> file is an XML-based format.<br>In order to import values and heirarchical structure from the file into Unity automatically, I’ll have to parse it in some way.<br>I can ignore many parts of the <code>urdf</code> specification as I don’t need them yet.<br>There are a few options:</p>
<ul>
<li><h3 id="Scene-files"><a href="#Scene-files" class="headerlink" title="Scene files"></a>Scene files</h3><p>The scene files in Unity hold the structure of <code>GameObjects</code>, their configuration, and how the world is laid out.<br>The online documentation for Unity states that the scene files can be saved in a <a href="https://docs.unity3d.com/Manual/TextSceneFormat.html" target="_blank" rel="external">text-based format</a>.<br>One option could be to use a program or script to create a new scene file with the <code>urdf</code> parameters within.</p>
</li>
<li><h3 id="Prefab"><a href="#Prefab" class="headerlink" title="Prefab"></a>Prefab</h3><p>Unity <code>GameObjects</code> can be instances of a <code>Prefab</code>. Usually, the <code>GameObjects</code> are instantiated from the pre-existing <code>Prefab</code>.<br>However, <code>Prefabs</code> can be retroactively created from a <code>GameObject</code>, and then the <code>GameObject</code> becomes an instance of that new <code>Prefab</code>.<br>One idea could have been to create <code>Prefabs</code> outside of Unity and then import them, but it looks like <code>Prefabs</code> are binary files (not zip files), and there’s no documentation of the format.</p>
</li>
<li><h3 id="Unity-script"><a href="#Unity-script" class="headerlink" title="Unity script"></a>Unity script</h3><p>There are methods in Unity for creating, instantiating, modifying and destroying <code>GameObjects</code>.<br>Scripts attached to <code>GameObjects</code> usually execute when the scene is set to run, but there are other ways they can be used to enhance the workflow of the developer.<br>If I can achieve a sufficient level of functionality with <code>C#</code> this seems like the best solution.</p>
<p>  Enter <code>AssetPostProcessor</code>.</p>
</li>
</ul>
<h3 id="AssetPostProcessor"><a href="#AssetPostProcessor" class="headerlink" title="AssetPostProcessor"></a>AssetPostProcessor</h3><p>According to the <a href="https://docs.unity3d.com/ScriptReference/AssetPostprocessor.html" target="_blank" rel="external">docs</a>:</p>
<blockquote>
<p><strong>AssetPostprocessor</strong> lets you hook into the import pipeline and run scripts prior or after importing assets.</p>
</blockquote>
<p>Create an <code>Editor</code> folder in the root directory of the project, if it doesn’t exist already.<br>(You can re-import assets by right-clicking them and selecting, <code>Reimport</code>.)</p>
<p>At first, the script runs for all assets, including itself!<br>By adding in some functions to check if the extension contains a <code>.urdf</code> file, we can filter the results.</p>
<figure class="highlight cs"><figcaption><span>urdfPostProcessor.cs initial version</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> UnityEditor;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.IO; <span class="comment">//For Path</span></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">urdfPostProcessor</span> : <span class="title">AssetPostprocessor</span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OnPostprocessAllAssets</span>(<span class="params"><span class="keyword">string</span>[] importedAssets, <span class="keyword">string</span>[] deletedAssets, <span class="keyword">string</span>[] movedAssets, <span class="keyword">string</span>[] movedFromPath</span>) </span>&#123;</div><div class="line">		<span class="keyword">foreach</span> (<span class="keyword">string</span> str <span class="keyword">in</span> importedAssets) &#123;</div><div class="line">			<span class="keyword">string</span> ext = Path.GetExtension(str);</div><div class="line">			<span class="keyword">if</span> (ext == <span class="string">".xacro"</span>)</div><div class="line">				ext = Path.GetExtension(Path.GetFileNameWithoutExtension(str));</div><div class="line">			<span class="keyword">if</span> (ext == <span class="string">".urdf"</span>)</div><div class="line">				Debug.Log(<span class="string">"YES: "</span>+str);</div><div class="line">			<span class="keyword">else</span></div><div class="line">				Debug.Log(<span class="string">"no: "</span>+str);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now that this script runs for each <code>urdf</code> file, we can try to access some of the data.<br>It is reccommended to use the system’s xml parsing.<br><figure class="highlight cs"><figcaption><span>urdfPostProcessor.cs continued</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="keyword">using</span> System.Xml; <span class="comment">//For urdf</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">importURDF</span>(<span class="params"><span class="keyword">string</span> filename</span>) </span>&#123;</div><div class="line">		<span class="comment">//Load XML file</span></div><div class="line">		<span class="keyword">var</span> xmlData = <span class="keyword">new</span> XmlDocument();</div><div class="line">		xmlData.Load(filename);</div><div class="line">		<span class="comment">//Set root</span></div><div class="line">		<span class="keyword">var</span> root = xmlData.DocumentElement;<span class="comment">//.GetEnumerator();</span></div><div class="line">		<span class="comment">//Create nodelist</span></div><div class="line">		XmlNodeList nodeList;</div><div class="line">		nodeList = root.SelectNodes(<span class="string">"link"</span>);</div><div class="line">		<span class="comment">//Print out some results</span></div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;nodeList.Count; i++) &#123;</div><div class="line">			<span class="keyword">var</span> node = nodeList[i];</div><div class="line">			XmlNode ret = node.SelectSingleNode(<span class="string">"visual/origin"</span>);</div><div class="line">			<span class="keyword">if</span> (ret != <span class="literal">null</span>)</div><div class="line">				Debug.Log(node.Attributes[<span class="string">"name"</span>].Value+<span class="string">": "</span>+ret.Attributes[<span class="string">"rpy"</span>].Value);</div><div class="line">		&#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>The code above finds the <code>urdf</code> links which have a <code>visual</code> child, with an <code>origin</code> child of its own.<br>For each of those, it prints their names and the <code>rpy</code> values of the origin node.</p>
<p><img src="/Robotic-Telepresence/2016/11/13/Importing-directly-from-URDF/XML Values.png" alt="Values from the XML in the debug logger in Unity"></p>
<p>This isn’t exactly what we want, because it doesn’t follow the hierarchy. But we’re getting there.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/13/Importing-directly-from-URDF/" data-id="cizlhttas000l509r43ulu0r7" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Coordinate-system-converted" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/09/Coordinate-system-converted/">Coordinate system converted</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/09/Coordinate-system-converted/" class="article-date">
  <time datetime="2016-11-09T13:04:25.000Z" itemprop="datePublished">Wed 09/11/2016 13:04</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h3 id="Differences"><a href="#Differences" class="headerlink" title="Differences"></a>Differences</h3><p>ROS uses a right-handed coordinate system.<br>Unity uses a left-handed coordinate system.<br>(<a href="https://en.wikipedia.org/wiki/Right-hand_rule" target="_blank" rel="external">handedness</a>)</p>
<h3 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h3><p>ROS uses <a href="http://www.ros.org/reps/rep-0103.html" target="_blank" rel="external">this convention</a>:</p>
<blockquote>
<table>
<thead>
<tr>
<th>Axis</th>
<th>ROS Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td>X +ve</td>
<td>forwards</td>
</tr>
<tr>
<td>Y +ve</td>
<td>left</td>
</tr>
<tr>
<td>Z +ve</td>
<td>up</td>
</tr>
</tbody>
</table>
</blockquote>
<p>On importing Baxter models as a Unity assets, they come in at +90 degrees rotated around Unity’s X axis.<br>In relation to Baxter, the Unity coordinate system is:</p>
<blockquote>
<table>
<thead>
<tr>
<th>Axis</th>
<th>Unity Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td>X +ve</td>
<td>backwards</td>
</tr>
<tr>
<td>Y +ve</td>
<td>left</td>
</tr>
<tr>
<td>Z +ve</td>
<td>up</td>
</tr>
</tbody>
</table>
</blockquote>
<p>When the parent-most GameObject is rotated so that Baxter is upright, the child XYZ frame is also rotated.<br>So for translation, all I need to do is negate the X translation.</p>
<h3 id="Rotation"><a href="#Rotation" class="headerlink" title="Rotation"></a>Rotation</h3><p>The following table describes what an increase in rotation value for each axis looks like in ROS and Unity (using local rotations).<br>As the axes for translations can now match up, disregarding negativity they should for rotations.</p>
<blockquote>
<table>
<thead>
<tr>
<th>Rotation</th>
<th>Label</th>
<th>Axis</th>
<th>Direction in ROS</th>
<th>Direction in Unity</th>
</tr>
</thead>
<tbody>
<tr>
<td>Roll</td>
<td>r</td>
<td>X (+ve)</td>
<td>right</td>
<td>right</td>
</tr>
<tr>
<td>Pitch</td>
<td>p</td>
<td>Y (+ve)</td>
<td>forwards</td>
<td>backwards</td>
</tr>
<tr>
<td>Yaw</td>
<td>y</td>
<td>Z (+ve)</td>
<td>left</td>
<td>right</td>
</tr>
</tbody>
</table>
</blockquote>
<p>The order in which rotations are performed makes a difference.<br>The code in the following script was used to successfully rotate the meshes to the correct starting positions.<br><figure class="highlight cs"><figcaption><span>ConvertCoordinateSystem.cs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InitialRotation</span> : <span class="title">MonoBehaviour</span> &#123;</div><div class="line">	<span class="keyword">public</span> Vector3 input = <span class="keyword">new</span> Vector3();</div><div class="line">	<span class="keyword">public</span> Vector3 angles = <span class="keyword">new</span> Vector3(<span class="number">0.0</span>f, <span class="number">0.0</span>f, <span class="number">0.0</span>f);</div><div class="line">	<span class="keyword">private</span> Vector3 saved;</div><div class="line"></div><div class="line">	<span class="comment">// Use this for initialization</span></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span> (<span class="params"></span>) </span>&#123;</div><div class="line">		angles.x = input.x * Mathf.Rad2Deg;</div><div class="line">		angles.y = input.y * Mathf.Rad2Deg;</div><div class="line">		angles.z = input.z * Mathf.Rad2Deg;</div><div class="line"></div><div class="line">		transform.localEulerAngles = Vector3.zero;</div><div class="line">		transform.Rotate(<span class="number">0</span>, <span class="number">0</span>, -angles.z, Space.Self);</div><div class="line">		transform.Rotate(<span class="number">0</span>, -angles.y, <span class="number">0</span>, Space.Self);</div><div class="line">		transform.Rotate(angles.x, <span class="number">0</span>, <span class="number">0</span>, Space.Self);</div><div class="line">		saved = transform.localEulerAngles;</div><div class="line"></div><div class="line">		<span class="comment">//Don't switch to the game window</span></div><div class="line">		UnityEditor.SceneView.FocusWindowIfItsOpen(<span class="keyword">typeof</span>(UnityEditor.SceneView));</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Update is called once per frame</span></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Update</span> (<span class="params"></span>) </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The <code>Vector3</code> variable ‘Input’ was used to manually enter the values from the <code>.xacro.urdf</code> file.<br>The <code>Vector3</code> variable ‘angles’ I used as an indicator to show what (additional?) rotation was being performed on the part.</p>
<p><img src="/Robotic-Telepresence/2016/11/09/Coordinate-system-converted/Inputs.png" alt="Script inputs"></p>
<p>To verify that the script was working, I rotated the joints using the <code>&lt;limit lower/&gt;</code> and <code>&lt;limit upper/&gt;</code> values to see if the arm would clip into another body part.<br>This showed that it worked correctly, because there was no clipping.<br>It showed that the shape of Baxter has been designed so that there are hollows for the respective protruding parts to get a larger operating range of movement.</p>
<p><img src="/Robotic-Telepresence/2016/11/09/Coordinate-system-converted/Limits.png" alt="Verifying the joint limits"></p>
<p>I had trouble importing E1 (lower elbow) and E0 for some reason, maybe it was a corrupt file.<br>Replacing it with a fresh one from the GitHub repository solved the issue.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/09/Coordinate-system-converted/" data-id="cizlhttaa0006509rn3udh4r3" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/08/Project-meeting-3/">Project meeting 3</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/08/Project-meeting-3/" class="article-date">
  <time datetime="2016-11-08T20:07:40.000Z" itemprop="datePublished">Tue 08/11/2016 20:07</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I still need to get swipe access to the robot lab.<br>After that I need to do health and safety briefing for Baxter.</p>
<p>I confirmed my suspicions that ROS versions don’t generally mix, while the Kinetic upgrade is an especially significant change.<br>Baxter is running on Indigo and I would need a very good reason to use Kinetic instead.<br>Remember, Indigo doesn’t work on Ubuntu 16. Use 14 for the LTS.</p>
<p>I got Oscar to send me some point cloud data</p>
<ul>
<li>Raw data directly from kinect (428MB)</li>
<li>Coloured data (571MB)</li>
<li>Coloured subsampled data (6.39MB)</li>
<li>Monocular reconstruction cloud (17MB)</li>
<li>Octree (53.1MB)<br>The point cloud data is in <code>.ply</code> binary format.</li>
</ul>
<p>He also sent me a list of libraries I’ll need to generate/view it.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">meshlab</div><div class="line">ros-indigo-octomap</div><div class="line">ros-indigo-octomap-mapping</div><div class="line">ros-indigo-octomap-msgs</div><div class="line">ros-indigo-octomap-ros</div><div class="line">ros-indigo-octomap-rviz-plugins </div><div class="line">ros-indigo-octomap-server</div><div class="line">ros-indigo-octovis</div></pre></td></tr></table></figure></p>
<p>Also, a link to the wiki page for <a href="http://wiki.ros.org/rosserial_windows/Tutorials/Hello%20World" target="_blank" rel="external">sending serial messages to ROS from Windows</a>.</p>
<p>Oscar also said that a Raspberry Pi may not have a fast enough internet connection to handle the point cloud data, or have very good latency.<br>This isn’t too much of a problem. In the robot lab, there’s a computer dedicated to Baxter which has university log-on (first run will apparently still be a pain)<br>The others (including the beefy one with 4x12GB VRAM) don’t, but I’ll get some help when the time comes.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/08/Project-meeting-3/" data-id="cizlhttb5000x509rpkw1ghzf" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Site-update" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/08/Site-update/">Site update</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/08/Site-update/" class="article-date">
  <time datetime="2016-11-08T10:34:57.000Z" itemprop="datePublished">Tue 08/11/2016 10:34</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’ve inserted Gantt chart using a navbar link.<br>I tried doing an iframe in a page, but I couldn’t modify the <code>.styl</code> and <code>.ejs</code> theme files to make the post wide enough to view the chart properly.</p>
<p>I can update it through the page because of my cookies, but other people can only view.<br>It keeps up to date, so I can fill out the progess/overhaul it when I throw it out of the window.</p>
<p>I’ve also enhanced the code blocks, quote blocks, margins and header.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/08/Site-update/" data-id="cizlhttbg0019509r47ueb9dh" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Images-in-the-hexo-site" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/05/Images-in-the-hexo-site/">Images in the hexo site</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/05/Images-in-the-hexo-site/" class="article-date">
  <time datetime="2016-11-05T20:55:44.000Z" itemprop="datePublished">Sat 05/11/2016 21:55</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’ve been having problems showing images in the generated html.<br>I’ve added this line in the main configuration:<br><figure class="highlight yml"><figcaption><span>config.yml</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></div></pre></td></tr></table></figure></p>
<p>This means that for each post created, an extra empty directory with the same name as the post is created alongside.<br>It also makes sense to keep the images with their respective post and not mashed together in a single folder.</p>
<p>I’m also having to put the absolute path for the images in the markdown, because they don’t display on the index page.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/05/Images-in-the-hexo-site/" data-id="cizlhttah000b509r70ajuh3p" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-VR-with-VRUI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/11/02/VR-with-VRUI/">VR with VRUI</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/11/02/VR-with-VRUI/" class="article-date">
  <time datetime="2016-11-02T12:33:20.000Z" itemprop="datePublished">Wed 02/11/2016 13:33</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>A few things have surfaced this week, primarily, Vive support for <code>vrui</code> in Linux.<br>I downloaded the source:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ wget http://idav.ucdavis.edu/~okreylos/ResDev/Vrui/Build-Ubuntu.sh</div><div class="line">$ sha1sum Build-Ubuntu.sh</div><div class="line">$ ./Build-Ubuntu.sh</div><div class="line">$ <span class="built_in">cd</span> ~/src/Vrui-4.2-004</div></pre></td></tr></table></figure></p>
<p>There’s a part which enables device permissions for “non-standard devices”.<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo make installudevrules</div></pre></td></tr></table></figure></p>
<p>I wondered if this would fix the issues I was having with SteamVR, <a href="/Robotic-Telepresence/2016/10/19/Attempting-VR-in-Ubuntu/">here</a>.<br>No luck.</p>
<p>Time to try <code>Vrui</code> with the Vive.<br>I had to go to the Vrui release <a href="http://doc-ok.org/?p=1508" target="_blank" rel="external">blog post</a> in order to find full specific install instructions:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span></div><div class="line">$ wget http://idav.ucdavis.edu/~okreylos/ResDev/Vrui/Build-Ubuntu.sh</div><div class="line">$ bash Build-Ubuntu.sh</div><div class="line">$ <span class="built_in">cd</span> ~/src/Vrui-4.2-004</div><div class="line">$ make STEAMVRDIR=/home/celynwalters/.steam/steam/steamapps/common/SteamVR/</div><div class="line">$ sudo make STEAMVRDIR=/home/celynwalters/.steam/steam/steamapps/common/SteamVR/ install</div></pre></td></tr></table></figure></p>
<p>However, the tracking driver still fails:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ RunViveTracker.sh</div><div class="line">VRDeviceDaemon: Reading configuration file</div><div class="line">/usr/<span class="built_in">local</span>/bin/VRDeviceDaemon: relocation error: /usr/<span class="built_in">local</span>/lib/x86_64-linux-gnu/Vrui-4.2/libMisc.g++-3.so.4: symbol _ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE10_M_replaceEmmPKcm, version GLIBCXX_3.4.21 not defined <span class="keyword">in</span> file libstdc++.so.6 with link time reference</div></pre></td></tr></table></figure></p>
<p>I found a <a href="https://www.reddit.com/r/Vive/comments/580ep4/vive_is_working_on_linux_steamvr_still_isnt_though/d8y9ent/" target="_blank" rel="external">reddit post</a> communicating with the tool author, <code>Doc_Ok</code>, who had my issue.<br><code>Doc_Ok</code> replied with a fix:</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ ldd /usr/<span class="built_in">local</span>/bin/VRDeviceDaemon</div><div class="line">	linux-vdso.so.1 =&gt;  (0x00007fff0fae4000)</div><div class="line">	libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fa3799ce000)</div><div class="line">	libComm.g++-3.so.4 =&gt; /usr/<span class="built_in">local</span>/lib/x86_64-linux-gnu/Vrui-4.2/libComm.g++-3.so.4 (0x00007fa3797b9000)</div><div class="line">	libGeometry.g++-3.so.4 =&gt; /usr/<span class="built_in">local</span>/lib/x86_64-linux-gnu/Vrui-4.2/libGeometry.g++-3.so.4 (0x00007fa379477000)</div><div class="line">	libIO.g++-3.so.4 =&gt; /usr/<span class="built_in">local</span>/lib/x86_64-linux-gnu/Vrui-4.2/libIO.g++-3.so.4 (0x00007fa37924b000)</div><div class="line">	libMisc.g++-3.so.4 =&gt; /usr/<span class="built_in">local</span>/lib/x86_64-linux-gnu/Vrui-4.2/libMisc.g++-3.so.4 (0x00007fa37902c000)</div><div class="line">	libThreads.g++-3.so.4 =&gt; /usr/<span class="built_in">local</span>/lib/x86_64-linux-gnu/Vrui-4.2/libThreads.g++-3.so.4 (0x00007fa378e26000)</div><div class="line">	libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fa378c09000)</div><div class="line">	libstdc++.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007fa378887000)</div><div class="line">	libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fa37857d000)</div><div class="line">	libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fa378367000)</div><div class="line">	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fa377f9e000)</div><div class="line">	/lib64/ld-linux-x86-64.so.2 (0x000055761dc87000)</div><div class="line">	libMath.g++-3.so.4 =&gt; /usr/<span class="built_in">local</span>/lib/x86_64-linux-gnu/Vrui-4.2/libMath.g++-3.so.4 (0x00007fa377d86000)</div><div class="line">	libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007fa377b6c000)</div></pre></td></tr></table></figure>
<p>The script was using Steam’s libstdc++, which I’ve redirected to use the built in ones.<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo nano $(<span class="built_in">which</span> RunViveTracker.sh)</div></pre></td></tr></table></figure></p>
<p>Replace the line:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RUNTIMEDIR2=$STEAMDIR/ubuntu12_32/steam-runtime/amd64/usr/lib/x86_64-linux-gnu</div></pre></td></tr></table></figure></p>
<p>with<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RUNTIMEDIR2=/usr/lib/</div></pre></td></tr></table></figure></p>
<h3 id="Sucess"><a href="#Sucess" class="headerlink" title="Sucess!"></a>Sucess!</h3><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">VRDeviceDaemon: Reading configuration file</div><div class="line">VRDeviceDaemon: Initializing device manager</div><div class="line">VRDeviceManager: Loading device Vive of <span class="built_in">type</span> OpenVRHost</div><div class="line">GetBool <span class="keyword">for</span> driver_lighthouse/dbhistory</div><div class="line">GetString <span class="keyword">for</span> driver_lighthouse/usedisambiguation</div><div class="line">GetInt32 <span class="keyword">for</span> driver_lighthouse/disambiguationdebug</div><div class="line">GetBool <span class="keyword">for</span> driver_lighthouse/disableimu</div><div class="line">GetInt32 <span class="keyword">for</span> driver_lighthouse/primarybasestation</div><div class="line">GetBool <span class="keyword">for</span> driver_lighthouse/trackedCamera</div><div class="line">OpenVRHost: Activating 1 tracked devices</div><div class="line">OpenVRHost: Activating tracked device 0 with ID 0</div><div class="line">GetBool <span class="keyword">for</span> driver_lighthouse/fakeHtcHmdMainboard</div><div class="line">OpenVRHost: Updating HMD configuration... <span class="keyword">done</span></div><div class="line">OpenVRHost: Battery level of device 0 is 100%</div><div class="line">VRDeviceManager: Managing 3 trackers, 10 buttons, 6 valuators</div><div class="line">VRDeviceManager: Managing 3 virtual devices</div><div class="line">VRDeviceDaemon: Initializing device server</div><div class="line">VRDeviceServer: Listening <span class="keyword">for</span> incoming connections on TCP port 8555</div><div class="line">ioctl (GFEATURE): Broken pipe</div><div class="line">...</div><div class="line">ioctl (SFEATURE): Broken pipe</div><div class="line">OpenVRHost: Updating HMD configuration... <span class="keyword">done</span></div><div class="line">OpenVRHost: Battery level of device 0 is 100%</div><div class="line">VRDeviceServer: Sending updated HMD configuration 0 to clients... <span class="keyword">done</span></div><div class="line">OpenVRHost: Updating HMD configuration... <span class="keyword">done</span></div><div class="line">OpenVRHost: Physical IPD on device 0 <span class="built_in">set</span> to 63.7mm</div><div class="line">OpenVRHost: Updating HMD configuration... <span class="keyword">done</span></div><div class="line">OpenVRHost: Physical IPD on device 0 <span class="built_in">set</span> to 63.7mm</div><div class="line">VRDeviceServer: Sending updated HMD configuration 0 to clients... <span class="keyword">done</span></div><div class="line">OpenVRHost: Adding device with serial number LHB-3CF79497</div><div class="line">OpenVRHost: Error retrieving connected device 1</div><div class="line">OpenVRHost: Adding device with serial number LHB-5CEC2D20</div><div class="line">OpenVRHost: Error retrieving connected device 1</div></pre></td></tr></table></figure>
<p>While this is running, we can run a position test in another shell:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ DeviceTest localhost:8555 -t 0 -p</div></pre></td></tr></table></figure></p>
<p>Giving us a real-time position:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">     Pos X     Pos Y     Pos Z</div><div class="line">(   -0.853    -0.863    -1.730)</div></pre></td></tr></table></figure></p>
<p>And more output in the original shell:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">Creating new client state... <span class="keyword">done</span></div><div class="line">VRDeviceServer: Connecting new client localhost:53204</div><div class="line">Adding new client state to list</div><div class="line">Adding listener <span class="keyword">for</span> client<span class="string">'s socket</span></div><div class="line">Client connected</div><div class="line">Reading message... done, 0</div><div class="line">Reading protocol version... done, 4</div><div class="line">Sending connect reply... done</div><div class="line">Reading message... done, 3</div><div class="line">VRDeviceManager: Starting devices</div><div class="line">Reading message... done, 7</div><div class="line">Sending packet reply... done</div><div class="line">VRDeviceServer: Disconnecting client localhost:53204 due to exception "Client terminated connection"</div><div class="line">VRDeviceManager: Stopping devices</div><div class="line">Creating new client state... done</div><div class="line">VRDeviceServer: Connecting new client localhost:53206</div><div class="line">Adding new client state to list</div><div class="line">Adding listener for client's socket</div><div class="line">Client connected</div><div class="line">Reading message... <span class="keyword">done</span>, 0</div><div class="line">Reading protocol version... <span class="keyword">done</span>, 4</div><div class="line">Sending connect reply... <span class="keyword">done</span></div><div class="line">Reading message... <span class="keyword">done</span>, 3</div><div class="line">VRDeviceManager: Starting devices</div><div class="line">Reading message... <span class="keyword">done</span>, 7</div><div class="line">Sending packet reply... <span class="keyword">done</span></div><div class="line">OpenVRHost: Updating HMD configuration... <span class="keyword">done</span></div><div class="line">OpenVRHost: Battery level of device 0 is 100%</div><div class="line">OpenVRHost: Device 0 has been connected</div><div class="line">OpenVRHost: World transform <span class="keyword">for</span> device 0: &#123;(0, 0, 0), &#123;(-0.995354, 0.0181601, 0.0945509), 0.381241&#125;&#125;</div><div class="line">OpenVRHost: Local transform <span class="keyword">for</span> device 0: &#123;(-0.00849516, -0.00496823, -0.0715013), &#123;(-1, -0, -0), 3.14159&#125;&#125;</div><div class="line">OpenVRHost: Updating HMD configuration... <span class="keyword">done</span></div><div class="line">OpenVRHost: Battery level of device 0 is 100%</div><div class="line">OpenVRHost: Proximity sensor on device 0 triggered</div><div class="line">OpenVRHost: Proximity sensor on device 0 untriggered</div><div class="line">OpenVRHost: Proximity sensor on device 0 triggered</div><div class="line">VRDeviceServer: Disconnecting client localhost:53206 due to exception <span class="string">"Client terminated connection"</span></div><div class="line">VRDeviceManager: Stopping devices</div></pre></td></tr></table></figure></p>
<p>We have tracking!<br>We can also try it out on a controller:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ DeviceTest localhost:8555 -t 1 -p -b</div></pre></td></tr></table></figure></p>
<p>Giving the position of one, and the button states for both:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">     Pos X     Pos Y     Pos Z</div><div class="line">(   -0.765    -1.238    -1.572) . . . . . X . . . X</div></pre></td></tr></table></figure></p>
<p>There’s even a room setup utility. Somehow it already knows my room layout so I skipped this step.<br>I went into <code>nvidia-settings</code> to turn on the Vive display. It acts as a desktop again.<br>My Vive had the display connector name <code>DPF-1</code>.<br>Set the environment variable, build and run the program:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">export</span> __GL_SYNC_DISPLAY_DEVICE=DFP-1</div><div class="line">$ <span class="built_in">cd</span> ~/src/Vrui-4.2-004/ExamplePrograms</div><div class="line">$ make INSTALLDIR=/usr/<span class="built_in">local</span></div><div class="line">$ sudo make INSTALLDIR=/usr/<span class="built_in">local</span> install</div><div class="line">$ ClusterJello -rootSection Vive</div></pre></td></tr></table></figure></p>
<p>It worked! I was put into a virtual environment<br>The VR lags a bit, which will cause motion sickness.<br>I’m not sure what the issue is which is causing it.<br>It could be a graphics driver incompatibility.</p>
<p><img src="/Robotic-Telepresence/2016/11/02/VR-with-VRUI/Cluster Jello.png" alt="I couldn&#39;t take a screenshot, but this the demo application I used, &#39;ClusterJello&#39;. Taken from Oliver Kreylos&#39; &lt;a href=https://www.youtube.com/watch?v=OJlzmKxDd40&gt;video&lt;/a&gt;"></p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/11/02/VR-with-VRUI/" data-id="cizlhttbw001h509rhmrwntoe" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Hexo-site" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/31/Hexo-site/">Hexo site</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/31/Hexo-site/" class="article-date">
  <time datetime="2016-10-31T19:36:53.000Z" itemprop="datePublished">Mon 31/10/2016 20:36</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>There has been a lot of trial and error (mostly error) with BitBucket, Aerobatic, Jekyll, GitHub, zsh, ssh keys etc. etc.<br>Finally, <a href="https://hexo.io/" target="_blank" rel="external">hexo</a> looks like the solution I was looking for.<br>I’m still yet to edit the site layout, css, hexo configuration, but I can now post my notes.<br>It doesn’t support mercurial, but the GitHub hosting is much better than that of BitBucket.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/31/Hexo-site/" data-id="cizlhttad0009509roc5t25p0" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Sorting-out-rotation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/30/Sorting-out-rotation/">Sorting out rotation</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/30/Sorting-out-rotation/" class="article-date">
  <time datetime="2016-10-30T11:55:44.000Z" itemprop="datePublished">Sun 30/10/2016 12:55</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I naïvely thought that if I rotate the object so that regardless of <em>which</em> axis is which, that all three from the <code>urdf</code> line up with those in Unity, I could then just swap them out with each other and everything would work.<br>However, this doesn’t seem to work. Maybe it’s something to do with Unity doing rotation in Z, then X, then Y according to the <a href="https://docs.unity3d.com/ScriptReference/Transform-eulerAngles.html" target="_blank" rel="external">docs</a>, whereas ROS does X, Y, Z.</p>
<p>This was a headache until I realised that instead of using the <code>transform.localEulerAngles</code>, I can use <code>transform.Rotate</code>.<br>Rather than setting the rotation it can apply one in a single axis.<br>Changing the order of rotations in a script <em>does</em> change the result, as one might expect.<br>However, there’s no combination of rotations with 100 degrees and 90 degrees which would place the screen in the correct location!</p>
<p>Much later - I’ve worked it out!<br>I’ve been presuming that every link definition has an origin rotation of zero.<br>This is true for all cases <em>except</em> the screen (which is a child of head_nod).<br>I think this is unique because this has display as a child which will need to be the correct way up in the simulator. D’oh!<br>I still haven’t worked out the correct rotation combinations for the script, another time.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/30/Sorting-out-rotation/" data-id="cizlhttbh001a509reeikzvyx" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Rigging-Baxter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/27/Rigging-Baxter/">Rigging Baxter</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/27/Rigging-Baxter/" class="article-date">
  <time datetime="2016-10-27T16:05:31.000Z" itemprop="datePublished">Thu 27/10/2016 17:05</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’ve managed to get the Baxter meshes into Unity, but they are completely separate parts.<br>ROS uses a <code>.urdf</code> file format to relate parts to each other, which isn’t directly compatible or convertible to a Unity supported format.<br>In order to progress, I need to manually rig Baxter.<br>I can view the official files as they are text-based (an <code>xml</code> format).<br>Within the <code>baxter.urdf</code> file, there is a header:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">baxter.urdf is DEPRECATED. It is included here for backward compatibility.</div><div class="line">Please use baxter.urdf.xacro by running:</div><div class="line">$ rosrun xacro xacro.py - -inorder `rospack find baxter_description`/urdf/baxter.urdf.xacro</div></pre></td></tr></table></figure></p>
<p>The <code>xacro</code> format also is <code>xml</code> based.<br>It seems to be the same, but also include metadata for the materials.<br>I’ll be using this <code>.urdf.xacro</code> file for reference and ignoring the <code>.urdf</code>.</p>
<p>I started with the torso, as that was described in the <code>baxter_base.urdf.xacro</code> as being at the origin.<br><img src="/Robotic-Telepresence/2016/10/27/Rigging-Baxter/Torso.png" alt=""><br>I am thinking of adding the collision models later when(/if) I need to.<br>There are two files in the head folder, <code>H0</code> and <code>H1</code>. The <code>urdf</code> describes <code>H1</code> being called the ‘screen’.<br>By looking at photos of a fully assembled Baxter, <code>H1</code> is a round part which appears to attach below the head part of the torso model, and the screen should attach to that.<br>Unfortunately, the coordinates in the <code>urdf</code> do not match the coordinate system in Unity.</p>
<ul>
<li>An decrease in <code>Z</code> in the <code>urdf</code> is an increase in <code>Y</code> in Unity.</li>
<li>The units in the <code>urdf</code> appear to be almost 100x smaller than those in Unity.<br>Even manually moving the <code>H0</code> part to the correct Y location, it is still offset, even though the <code>urdf</code> describes the other axes as being zero.<br><img src="/Robotic-Telepresence/2016/10/27/Rigging-Baxter/Offset.png" alt="Showing the strange offset"></li>
</ul>
<p>I also noticed that the screen (<code>H1</code>) was rotated 90 degrees. The <code>urdf</code> describes the rotation in radians, while Unity describes it in degrees.</p>
<p>Looking at a <code>urdf</code> <a href="http://wiki.ros.org/urdf/Tutorials/Building%20a%20Visual%20Robot%20Model%20with%20URDF%20from%20Scratch" target="_blank" rel="external">tutorial</a>, ROS uses metres as the units of distance.<br>Unity uses generic units, but in relation to the scale of the model parts this looks about correct.</p>
<p>After writing half an email to Oscar, I worked it out.<br>I had a better look at the <code>urdf</code> and noticed that the <code>&quot;head&quot;</code> link is mentioned in some <code>joint</code> objects.<br>Specifically, the <code>&quot;head_pan&quot;</code> joint with the parent of <code>&quot;torso&quot;</code> and the child of <code>&quot;head&quot;</code> had the correct coordinates (some inverted and not the correct xyz).<br>The <code>urdf</code> is heirarchical, with inherited transformations.<br>Unity also works like this, so I can lay out Unity GameObjects in the same manner as in the <code>urdf</code>. Duh.<br>Perhaps the origin values in the links themselves could be the internal origins in the <code>.dae</code> files?</p>
<p>I started off with the parent-most object: the <code>base</code>. Everything inherits from here.<br>As I went along, GameObjects were made for joints, links, parents, children… I started assigning Unity tags to them to remember what was what, keeping their original names.<br>The <code>head_camera</code> joint has a child link called <code>head_camera</code>, so GameObjects like these need to be separate.<br>As I was going through, it became obvious that going down the hierarchy, it alternates between joint and link.<br>Imay have to specify between <code>&quot;fixed&quot;</code> and <code>&quot;revolute&quot;</code> joint types.<br>To save myself some work, I copied the right arm to the left once I’d created all of the GameObjects.<br>There will still be a good amount of work to input all of the coordinates.<br>I think this is necessary, even if I do end up making a converter, so that I understand it and I know it works.<br>When dragging the models in, these should replace the relevant “URDF link” tagged GameObjects.</p>
<p>I dragged in the torso, pedestal, head mount and screen.<br>The screen has some rotation which I need to work out.</p>
<p>I can’t work out the rotation for the screen (<code>head_nod</code>), so I’ll continue adding parts for now.<br>Is the origin of each model as described in the <code>urdf</code> the origin in the DAE file? Does Unity see this?<br>If so, undoing that in the parent GameObject will be good?<br>By comparing the <code>left_torso_arm_mount</code> and the <code>right_torso_arm_mount</code>, we can see which numbers are mirrored, and so which correspond to what?</p>
<p>I talked with a housemate who worked with Unity on placement.<br>When you drag a <code>.DAE</code> into Unity, it creates a new GameObject, which contains 3 children:</p>
<ul>
<li>Camera</li>
<li>Lamp</li>
<li>Mesh (with the same name as the GameObject)</li>
</ul>
<p>He pointed out that the Camera and Lamp are not created by Unity, but exported from whatever was used to design the models (Blender/3DS Max).</p>
<p>Changing a GameObject’s parent does not move the object in the scene. As a result, a transformation is applied to counteract the change the parent’s transformation has on this GameObject.<br>I didn’t realise this until I messed up the values everywhere. Correcting…</p>
<p>I got pretty confused with the combined rotations for the screen, so I’m going to try doing the arms.<br>Some of the transformations don’t seem to make sense. The part can be perfectly in place but have one transformation still to do.<br>I think the rotations are being done in the wrong order.</p>
<p>I found somebody trying to do exactly what I am, <a href="https://forum.unity3d.com/threads/problem-with-setting-game-object-rotation.426902/" target="_blank" rel="external">here</a>, but their problem is related to gimbal lock with eurler angles.</p>
<h3 id="Looking-at-an-example"><a href="#Looking-at-an-example" class="headerlink" title="Looking at an example"></a>Looking at an example</h3><p>If I could get <code>Gazebo</code> to work in a virtual machine, I can see what baxter looks like at time=0 on one monitor, and have Unity on the other.<br>I had some problems getting it to run.<br>The problems were caused by VirtualBox Additions, for shared folders/clipboard, resolution fixes etc.<br>However I still can’t get it to run. I think there’s some incompatibility between ROS Kinetic and Indigo.<br>(The <a href="http://sdk.rethinkrobotics.com/wiki/Baxter_Simulator" target="_blank" rel="external">website</a> only gives support for up to Indigo).<br>I’ve also found that Indigo isn’t supported on Ubuntu 16! Only <a href="http://answers.ros.org/question/240718/installing-indigo-after-kinetic" target="_blank" rel="external">13 and 14</a>.</p>
<p>I created a new virtual machine, and I seemed to get close to it working, but it started quitting with no error feedback,</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/27/Rigging-Baxter/" data-id="cizlhttbc0016509rijycofjv" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Jekyll-site" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/26/Jekyll-site/">Jekyll site</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/26/Jekyll-site/" class="article-date">
  <time datetime="2016-10-26T17:35:15.000Z" itemprop="datePublished">Wed 26/10/2016 18:35</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>After some research I’ve found a possibly good solution.<br>Currently I’m keeping my notes as markdown on a USB stick under source control (Mercurial).<br>If I push them to my bitbucket repository, they can be hosted under the URL:</p>
<blockquote>
<p><strong>USERNAME</strong>.bitbucket.io</p>
</blockquote>
<p>The page can host anything static. No PHP, but you can do a lot with JS and CSS.<br>Set up the <code>Aerobatic</code> BitBucket plugin. It’s supposed to support jekyll, so that I can just push new Markdown to the repo and it will rebuild the site for me.</p>
<p>I’ve got jekyll to work, however I’ve found out that the Aerobatic plugin for BitBucket only has 5 publishes per 24 hours.<br>I’m going to see if I can run it locally to preview before pushing, but this could be a dealbreaker.<br>I’ve got jekyll to work locally.<br>I can’t get the automatic updating when a file is edited to work, but it doesn’t matter so much.</p>
<p>Currently my notes are one big markdown file, I’m going to split them into individual posts.</p>
<p>I’ve run into some problems with the index page.<br>Aerobatic couldn’t find the index.html.<br>It’s not in the jekyll folder in the repo, I assumed everything would be OK seeing as though it served locally well.<br>It turns out the problem was that local Jekyll was using <code>index.md</code>, and Aerobatic was <em>specifically</em> looking for <code>index.html</code></p>
<p>Aerobatic won’t populate the index.html either, it needs to work on <code>.md</code> files. Hmm. Will sort it out another time.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/26/Jekyll-site/" data-id="cizlhttam000g509r6xwr7gdb" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/26/Project-meeting-2/">Project meeting 2</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/26/Project-meeting-2/" class="article-date">
  <time datetime="2016-10-26T15:08:54.000Z" itemprop="datePublished">Wed 26/10/2016 16:08</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h3 id="Housekeeping"><a href="#Housekeeping" class="headerlink" title="Housekeeping"></a>Housekeeping</h3><ul>
<li>I haven’t filled out the project health and safety form. Bring it to the next meeting!</li>
<li>I’m required to take notes. I should also keep them in a format which Rich can read<br>  In the past people have used Google Docs. I like the idea of keeping my notes in Markdown so I might end up using an online host for that.</li>
<li>When will I have something shiny to show?<br>  I’ve made a Gantt chart, but I didn’t bring it.<br>  I may need to change it over the next few weeks as well<br>  If I’m taking screenshots and hosting my notes, it will be easier to write my midterm/final report.</li>
<li>Poke Oscar about giving me some point cloud data.</li>
</ul>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/26/Project-meeting-2/" data-id="cizlhttb3000u509r4itq4mhf" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-ROS-tutorials" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/25/ROS-tutorials/">ROS tutorials</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/25/ROS-tutorials/" class="article-date">
  <time datetime="2016-10-25T20:33:36.000Z" itemprop="datePublished">Tue 25/10/2016 21:33</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’m going to do the ROS tutorials and get to grips with some of the terminology and terms.<br>I think the best method of approach now is to actually use Windows for development.</p>
<p>I did most of the tutorials with the turtle.<br>I’ve installed ROS on Ubuntu 16.04.1 LTS on my Raspberry Pi 2B.<br>Following meeting with Bowden, I’ve decided to publish my notes so he can read them remotely.<br>He said specifically he’s not going to pore them.<br>There was no preference for Google Drive or OneDrive.<br>In the end, I decided to stick with Markdown.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/25/ROS-tutorials/" data-id="cizlhttbb0014509rmcbagkl5" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Gazebo-VR" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/23/Gazebo-VR/">Gazebo VR</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/23/Gazebo-VR/" class="article-date">
  <time datetime="2016-10-23T16:02:34.000Z" itemprop="datePublished">Sun 23/10/2016 17:02</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>It turns out that the <a href="http://gazebosim.org/" target="_blank" rel="external">Gazebo Simulator</a> supports <a href="http://gazebosim.org/tutorials?tut=oculus" target="_blank" rel="external">Oculus Rift DK1 and DK2</a>!<br>I still can’t get this to work with the Vive (yet) unless I use Gazebo under Windows, and even then…<br>As far as I can tell, it just acts as a <a href="https://github.com/MohitShridhar/oculus_gazebo_navigator" target="_blank" rel="external">navigator</a>.<br>Although this is here, I still think it would be easier and possibly more useful to continue with Unity for now.</p>
<p>As it’s already installed, I check out Gazebo, and the shading isn’t awful:<br><img src="/Robotic-Telepresence/2016/10/23/Gazebo-VR/Gazebo Test.png" alt="The only models I could find easily"></p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/23/Gazebo-VR/" data-id="cizlhttak000d509rkzp5s7c6" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Robot-models" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/23/Robot-models/">Robot models</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/23/Robot-models/" class="article-date">
  <time datetime="2016-10-23T13:32:34.000Z" itemprop="datePublished">Sun 23/10/2016 14:32</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h3 id="URDF"><a href="#URDF" class="headerlink" title="URDF"></a>URDF</h3><p>I’ve found there’s a <a href="http://wiki.ros.org/urdf" target="_blank" rel="external">Unified Robot Description Format</a>, an XML format which ROS uses.<br>I don’t know the full extent for what it’s for or what it contains yet.</p>
<h3 id="Baxter-models"><a href="#Baxter-models" class="headerlink" title="Baxter models"></a>Baxter models</h3><p>There’s <a href="http://sdk.rethinkrobotics.com/wiki/URDF" target="_blank" rel="external">an official page</a> for Baxter’s URDF.<br>I will try to see how easy it is to input its information into Unity.<br>There’s also a <a href="https://github.com/RethinkRobotics" target="_blank" rel="external">GitHub page</a> for ReThink Robotics Inc. (Baxter).<br>Some of the meshes can be found there:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/RethinkRobotics/baxter_common</div></pre></td></tr></table></figure></p>
<p>Each body part is provided as a Collada <code>.dae</code> format.<br>Even the collision bounds models are included.<br>They can be dragged straight into Unity.<br><img src="/Robotic-Telepresence/2016/10/23/Robot-models/Models.png" alt="Showing the torso and some random arm parts"><br>The lighting and shading is immediately higher quality than that in the simulator, Gazebo:</p>
<p><img src="/Robotic-Telepresence/2016/10/23/Robot-models/Gazebo.png" alt="This was taken from the web as an example."><br>A Google search yields a URDF to Unity GameObject converter, <a href="https://github.com/MangoMangoDevelopment/neptune/wiki/Importing-and-Displaying-URDF-file" target="_blank" rel="external">neptune</a>.</p>
<blockquote>
<p>Our system will be able to detect when you’re importing a URDF and create a corresponding Unity GameObject to represent the robot/sensor.</p>
</blockquote>
<p>This will save time and maintain compatibility, rather than assembling the complete model myself.<br>Part of the <code>neptune</code> git clone seems to be a Unity project, so I’ve imported it and upgraded it to version 5.5.<br>It seems like I will have to use Visual Studio on Windows to compile the conversion utility, as Unity is expected to be running on Windows.</p>
<p>I managed to compile them, but I’m not sure how to use them. I am left with a <code>.dll</code> file in the ‘Debug’ directory.<br>It doesn’t help that the GitHub project is mostly private.</p>
<p>I looked up if you could get Gazebo running in Windows.<br>The <a href="http://gazebosim.org/tutorials?tut=install_on_windows&amp;cat=install" target="_blank" rel="external">site</a> says you can and gives instructions, but it’s easy to miss this statement:</p>
<blockquote>
<p>It does not actually work yet.</p>
</blockquote>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/23/Robot-models/" data-id="cizlhttbc0015509r12wzx1oq" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Project-meeting-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/21/Project-meeting-1/">Project meeting 1</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/21/Project-meeting-1/" class="article-date">
  <time datetime="2016-10-21T19:32:55.000Z" itemprop="datePublished">Fri 21/10/2016 20:32</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>Following meeting with Rich (21/10/16), these things were discussed:</p>
<ul>
<li>I need a plan, a Gantt chart.<br>  It should also take into account other things like exams, coursework, and holidays.</li>
<li>I don’t need to do it all on Linux if I’m going to be communcating with ROS anyway.<br>  ROS is specifically designed with strong communication support.<br>  Baxter and others run their own instances of ROS anyway, It’s ROS to ROS.<br>  If I had done this research first, I may have reached this conclusion.</li>
<li>I think, ideally we’d want a ‘ROS node’ which communicates with Unity.<br>  Alternatively a Unity plugin to communicate with ROS could work but that might be horrible.</li>
<li>Oscar mentioned octrees, how a 3D point cloud is represented in 3D space to give things surfaces.<br>  This might need to be done by me, but Unity as a game engine seems likely to have this built in, or have plugins for it.</li>
<li>Remember <code>rvis</code> is for visualising the robot.<br>  <code>Gazebo</code> isn’t the same, that is for simulation.</li>
</ul>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/21/Project-meeting-1/" data-id="cizlhttb0000s509r9e69iy5x" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Introduction-to-ROS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/21/Introduction-to-ROS/">Introduction to ROS</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/21/Introduction-to-ROS/" class="article-date">
  <time datetime="2016-10-21T09:31:34.000Z" itemprop="datePublished">Fri 21/10/2016 10:31</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>I’ll mostly be following the <a href="http://wiki.ros.org/kinetic/Installation/Ubuntu" target="_blank" rel="external">instructions</a> on the official ROS site, with some modifications.<br>First I had to add the ROS repository to the source list:<br><code>deb http://packages.ros.org/ros/ubuntu xenial main</code><br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-key adv --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-key 0xB01FA116</div><div class="line">$ sudo apt-get update</div><div class="line">$ sudo apt-get install ros-kinetic-desktop-full</div></pre></td></tr></table></figure></p>
<p>Initialise <code>rosdep</code>. Can install dependencies and required for some core components of ROS.<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo rosdep init</div><div class="line">$ rosdep update</div></pre></td></tr></table></figure></p>
<p>Set up the environment.<br><code>catkin</code> is the build system for ROS.<br>The installation instructions on the website assume you have <code>bash</code> as your shell.<br>I have <code>zsh</code>. The directory also has a set up script for <code>zsh</code> users too.<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">echo</span> <span class="string">". /opt/ros/kinetic/setup.zsh"</span> &gt;&gt; ~/.zshrc</div><div class="line">$ . ~/.zshrc</div></pre></td></tr></table></figure></p>
<p>Get rosinstall. Distributed separately, is for downloading source trees for ROS packages.<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install python-rosinstall</div></pre></td></tr></table></figure></p>
<h3 id="First-ROS-tests"><a href="#First-ROS-tests" class="headerlink" title="First ROS tests"></a>First ROS tests</h3><p>Checking the environment variables have been set:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ printenv | grep ROS</div></pre></td></tr></table></figure></p>
<p>Creating a ROS workspace:</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p ~/catkin_ws/src</div><div class="line">$ <span class="built_in">cd</span> !$</div><div class="line">$ catkin_init_workspace</div><div class="line">$ <span class="built_in">cd</span> ../</div><div class="line">$ catkin_make</div><div class="line">$ . devel/setup.zsh</div></pre></td></tr></table></figure>
<p>Now the environment has been overlayed onto our own. Check with:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">echo</span> <span class="variable">$ROS_PACKAGE_PATH</span></div></pre></td></tr></table></figure></p>
<h3 id="Tutorials"><a href="#Tutorials" class="headerlink" title="Tutorials"></a>Tutorials</h3><p>Install tutorials if I haven’t got them already:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install ros-kinetic-ros-tutorials</div></pre></td></tr></table></figure></p>
<p>There seems to be lots of interesting tools, which are all available with tab-completion. This explains the specific zsh and bash setup scripts.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/21/Introduction-to-ROS/" data-id="cizlhttal000e509rf25d35rt" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Unity3D-in-Xubuntu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/20/Unity3D-in-Xubuntu/">Unity3D in Xubuntu</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/20/Unity3D-in-Xubuntu/" class="article-date">
  <time datetime="2016-10-20T14:41:58.000Z" itemprop="datePublished">Thu 20/10/2016 15:41</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>The Unity website download page only lists <strong>Windows</strong> and <strong>MacOSX</strong> availability.<br>I finally managed to find the public beta <a href="https://forum.unity3d.com/threads/unity-on-linux-release-notes-and-known-issues.350256/" target="_blank" rel="external">Forum thread</a> with the Linux downloads.<br>I have the proprietary graphics drivers installed already, for my <strong>NVidia GTX 970</strong> GPU.<br>I’m going to try the most recent one, <code>5.5.0b5</code>.</p>
<p>I was able to get it to install and so far it appears to work flawlessly.<br><img src="/Robotic-Telepresence/2016/10/20/Unity3D-in-Xubuntu/Unity Linux.png" alt="Unity 5.5.0b5 in Xubuntu"><br>The title bar says <code>OpenGL 4.5</code>.<br>In Windows, this is what you do to enable virtual reality:<br>Install the <a href="https://www.assetstore.unity3d.com/en/#!/content/32647" target="_blank" rel="external">SteamVR Plugin</a> asset.<br>Go <code>Edit &gt; Project Settings &gt; Player &gt; Other Settings &gt; Virtual Reality Suported</code><br>But the <a href="https://docs.unity3d.com/Manual/VRDevices-OpenVR.html" target="_blank" rel="external">Unity page</a> for OpenVR states:</p>
<blockquote>
<p>Steam is required to run OpenVR applications, so install Steam and SteamVR. Once SteamVR is working properly with your headset, add OpenVR to the list of supported SDKs</p>
</blockquote>
<p>If I can get SteamVR (OpenVR) to work, this should be able to work as well, but this depends on that for now.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/20/Unity3D-in-Xubuntu/" data-id="cizlhttbj001d509ro3wax244" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Attempting-VR-in-Ubuntu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/19/Attempting-VR-in-Ubuntu/">Attempting VR in Ubuntu</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/19/Attempting-VR-in-Ubuntu/" class="article-date">
  <time datetime="2016-10-19T10:42:15.000Z" itemprop="datePublished">Wed 19/10/2016 11:42</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>To see whether this is plausible, I’ll be trying to get it to work.<br>There seem to be three options.</p>
<h3 id="VRUI"><a href="#VRUI" class="headerlink" title="VRUI"></a>VRUI</h3><p>Since trying to get OpenVR to work, I have found some software called <code>Vrui</code>.<br>It is developed by Oliver Kreylos, an associate researcher for virtual reality at <a href="http://www.ucdavis.edu/" target="_blank" rel="external">UC Davis</a>, goes under the name <a href="http://doc-ok.org/?page_id=6" target="_blank" rel="external">doc-ok</a>.<br>It can be found <a href="http://idav.ucdavis.edu/~okreylos/ResDev/Vrui/" target="_blank" rel="external">here</a>, and supposedly the next release will add Vive support<br>It is being actively updated.</p>
<h3 id="OSVR"><a href="#OSVR" class="headerlink" title="OSVR"></a>OSVR</h3><p>It’s an open source virtual reality project, which has a hardware and a software branch.<br>At the time of writing, there is no Vive support released, but this may change in the near future.<br>There’s already some Vive-related material on the official Github fork.</p>
<h3 id="OpenVR-in-Xubuntu"><a href="#OpenVR-in-Xubuntu" class="headerlink" title="OpenVR in Xubuntu"></a>OpenVR in Xubuntu</h3><p>Native support may be coming in the near future, particularly as SteamOS is Debian-based.</p>
<p>I will first try OpenVR by itself, without Unity.<br>It includes an application callled HelloVR.<br>Get <a href="this fork">https://github.com/ChristophHaag/openvr</a> of OpenVR:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/ChristophHaag/openvr.git</div><div class="line">$ <span class="built_in">cd</span> openvr</div><div class="line">$ mkdir build</div><div class="line">$ <span class="built_in">cd</span> !$</div><div class="line">$ cmake -DCMAKE_BUILD_TYPE=Release ../</div><div class="line">$ make</div></pre></td></tr></table></figure></p>
<p>Turns out I needed a couple of other packages:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install libsdl2-dev</div><div class="line">$ sudo apt-get install libglew-dev</div></pre></td></tr></table></figure></p>
<p>Now <strong>plug in the Vive</strong>.<br>Set up some permissions for the device:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo chmod a+rw /dev/hidraw*</div></pre></td></tr></table></figure></p>
<p>It seems I will have to install Steam and SteamVR after all. Let’s see what happens.<br>At time of writing in May 2016, apparently the beta branch of SteamVR did not work.<br>Supposedly the lighthouse drivers are included and working though.<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install steam</div></pre></td></tr></table></figure></p>
<p>Once it is installed, clicking on the VR icon as you would to run VR in Windows doesn’t start anything.<br>The following script should enable this to work:<br><figure class="highlight zsh"><figcaption><span>vrcmd</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/zsh</span></div><div class="line"><span class="built_in">export</span> openvr=~/openvr</div><div class="line"><span class="built_in">export</span> steam=~/.steam</div><div class="line"><span class="built_in">export</span> steamvr=<span class="variable">$steam</span>/steam/steamapps/common/SteamVR</div><div class="line"></div><div class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$LD_LIBRARY_PATH</span>:\</div><div class="line">/usr/lib/:\</div><div class="line">/usr/lib32/:\</div><div class="line"><span class="variable">$openvr</span>/lib/linux32/:\</div><div class="line"><span class="variable">$openvr</span>/lib/linux64/:\</div><div class="line"><span class="variable">$steam</span>/ubuntu12_32/steam-runtime/i386/lib/i386-linux-gnu/:\</div><div class="line"><span class="variable">$steam</span>/ubuntu12_32/steam-runtime/amd64/lib/x86_64-linux-gnu/:\</div><div class="line"><span class="variable">$steamvr</span>/bin/linux32/:\</div><div class="line"><span class="variable">$steamvr</span>/bin/linux64/:\</div><div class="line"><span class="variable">$steamvr</span>/drivers/lighthouse/bin/linux32/:\</div><div class="line"><span class="variable">$steamvr</span>/drivers/lighthouse/bin/linux64/</div></pre></td></tr></table></figure></p>
<p>Now you run <code>vrcmd</code> from the command line.<br>I got stuck here. The headset wasn’t found.</p>
<p>The <a href="https://github.com/OpenHMD/OpenHMD/blob/master/README.md" target="_blank" rel="external">OpenHMD readme</a> suggested this method to set permissions permanently:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">echo</span> <span class="string">'SUBSYSTEM=="usb", ATTR&#123;idVendor&#125;=="0bb4", MODE="0666", GROUP="plugdev"'</span> &gt;&gt; /etc/udev/rules.d/83-hmd.rules</div><div class="line">$ <span class="built_in">echo</span> <span class="string">'SUBSYSTEM=="usb", ATTR&#123;idVendor&#125;=="28de", MODE="0666", GROUP="plugdev"'</span> &gt;&gt; /etc/udev/rules.d/83-hmd.rules</div><div class="line">$ udevadm control --reload-rules</div></pre></td></tr></table></figure></p>
<p>I tried doing this to fix the problem.<br>The file <code>/etc/udev/rules.d/83-hmd.rules</code> didn’t exist yet, it was created.<br>I ran <code>dmesg</code> and these were related to plugging in the Vive:</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[23323.256741] hid-generic 0003:0BB4:2C87.0006: hiddev0,hidraw5: USB HID v1.11 Device [HTC HTC Vive] on usb-0000:08:00.0-2.1.5/input0</div><div class="line">[23328.501417] hid-generic 0003:28DE:2101.0007: hiddev0,hidraw6: USB HID v1.11 Device [Valve Software Watchman Dongle] on usb-0000:08:00.0-2.1.6/input0</div><div class="line">[23328.797700] hid-generic 0003:28DE:2101.0008: hiddev0,hidraw7: USB HID v1.11 Device [Valve Software Watchman Dongle] on usb-0000:08:00.0-2.1.7/input0</div><div class="line">[23329.090160] hid-generic 0003:28DE:2000.0009: hiddev0,hidraw8: USB HID v1.01 Device [Valve Software Lighthouse FPGA RX] on usb-0000:08:00.0-2.1.1/input0</div><div class="line">[23329.091253] hid-generic 0003:28DE:2000.000A: hiddev0,hidraw9: USB HID v1.01 Device [Valve Software Lighthouse FPGA RX] on usb-0000:08:00.0-2.1.1/input1</div><div class="line">[23329.447498] hid-generic 0003:0D8C:0012.000B: input,hidraw10: USB HID v1.00 Device [C-Media Electronics Inc. USB Audio Device] on usb-0000:08:00.0-2.1.4/input3</div><div class="line">[23329.647254] usb 3-2.1.2: new high-speed USB device number 11 using xhci_hcd</div></pre></td></tr></table></figure>
<p>The vendor IDs, <code>0BB4</code> and <code>28DE</code> matched the rules entered earlier.<br>There is an extra one for the audio, <code>0D8C</code>. I’m not sure if this is related, I may have to add this as a rule somewhere later.</p>
<p>This potential fix didn’t help.</p>
<p>Poking around I noticed that the <code>vrcmd</code> script wasn’t running properly.<br>It turned out that it was using Windows line endings. I converted them to Unix line endings.<br>Still no help.<br>The only discernable message from running <code>vrcmd</code> is</p>
<figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">libdbus-1.so.3: no version information available</div><div class="line">libgpg-error.so.0: no version information available</div></pre></td></tr></table></figure>
<p>Installing these does not make any difference, I suspect there’s a PATH issue maybe it’s not too important.</p>
<p>I <em>did</em> notice that the HMD display has turned up in the Displays settings for Xubuntu. As an additional monitor.<br><img src="/Robotic-Telepresence/2016/10/19/Attempting-VR-in-Ubuntu/Displays Preferences.png" alt="Xubuntu Display Settings"><br>Changing the display projection enabled the Vive to be used as a screen:<br><img src="/Robotic-Telepresence/2016/10/19/Attempting-VR-in-Ubuntu/VR Screen.jpg" alt="Photo of screen through lenses. It&#39;s split over each eye"><br>After a reboot, <code>vrcmd</code> didn’t give a million broken pipe errors, but it had the same effective result. Running it as root doesn’t help.<br>I tried mashing the script into one command:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">export</span> LD_LIBRARY_PATH=<span class="variable">$LD_LIBRARY_PATH</span>:/usr/lib/:/usr/lib32/:~/openvr/lib/linux32/:~/openvr/lib/linux64/:~/.steam/ubuntu12_32/steam-runtime/i386/lib/i386-linux-gnu/:~/.steam/ubuntu12_32/steam-runtime/amd64/lib/x86_64-linux-gnu/:~/.steam/steam/steamapps/common/SteamVR/bin/linux32/:~/.steam/steam/steamapps/common/SteamVR/bin/linux64/:~/.steam/steam/steamapps/common/SteamVR/drivers/lighthouse/bin/linux32/:~/.steam/steam/steamapps/common/SteamVR/drivers/lighthouse/bin/linux64/</div><div class="line">$ ./.steam/steam/steamapps/common/SteamVR/bin/linux64/vrserver</div></pre></td></tr></table></figure></p>
<p>Now <code>vrserver</code> will run without error instead of not detecting a headset, but it still doesn’t detect one. <code>vrcmd</code> still doesn’t detect it either.<br>When the Vive is unplugged though, it only gives this message:<br><figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VR_IsHmdPresent returned <span class="literal">false</span> to indicate that there are no attached HMDs.</div></pre></td></tr></table></figure></p>
<p>This means it is detected in some way.</p>
<p>This took a long time, so I will give up for now.</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/19/Attempting-VR-in-Ubuntu/" data-id="cizlhtta10003509rl3ahy1s2" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Environment-setup" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/15/Environment-setup/">Environment setup</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/15/Environment-setup/" class="article-date">
  <time datetime="2016-10-15T13:29:38.000Z" itemprop="datePublished">Sat 15/10/2016 14:29</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <p>The first thing I can do without doing any research is to set up my environment.<br>I know I will probably change my mind as things progress.</p>
<h3 id="Things-I-did"><a href="#Things-I-did" class="headerlink" title="Things I did"></a>Things I did</h3><p>I installed stock Ubuntu in a virtual machine, as I already had the disc image downloaded.<br>It was very easy, but I really didn’t, and still don’t like the Unity desktop environment.<br>It also comes preinstalled with a lot of things I never use.</p>
<p>I opted for Xubuntu, which uses XFCE, and I made a physical partition. I’m pleased with the results.<br>I will continue to use Sublime Text 3 as my text editor, and a customised <code>zsh</code> shell environment.</p>
<p>I will be keeping my project files under source control.<br>I used mercurial a lot on placement and it seems easier than git, so once things get rolling I’ll be doing this.<br>I know how to use virtual environments and pip with python, but I won’t do this until I know I need it.<br>I’ll be trying to take regular screenshots/photos to stick in here.</p>
<h3 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h3><p>I need any notes to be portable between computers and operating systems (This means no Microsoft Office!)<br>Microsoft Office provide an online version of Office which is surprisingly good. But I’ll have to worry about logging in, inserting media into the documents and no organisation between documents beside what I can do with folders.<br>I already have an excellent Markdown editor (Sublime Text) which doubles for code.<br>I know the GitHub ‘about’ pages are written in Markdown, so it must have good support for inserting code snippets.</p>
<p>After looking around, I’m installing <code>markmon</code>, an automatic markdown preview tool, which generates platform-independent HTML on-the-fly as I write.</p>
<ul>
<li>Install Package Control for Sublime Text</li>
<li><p>Install <code>markmon</code> to autogenerate the markdown preview<br>  Has some external dependencies:</p>
  <figure class="highlight zsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo ln <span class="_">-s</span> /usr/bin/nodejs /usr/bin/node</div><div class="line">$ sudo apt-get install npm</div><div class="line">$ sudo npm install -g markmon</div><div class="line">$ sudo apt-get install pandoc</div></pre></td></tr></table></figure>
</li>
<li><p>I’ve added a keyboard shortcut <code>alt+m</code> to serve and bring up the HTML page.<br>  Markmon works on Windows, but doesn’t appear to be able to use Cygwin.<br>  I had to go into the markmon settings and modify them like this:</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"executable": "markmon.cmd"</div></pre></td></tr></table></figure>
</li>
</ul>
<p>Here’s a screenshot of it in action:</p>
<p><img src="/Robotic-Telepresence/2016/10/15/Environment-setup/Markmon.png" alt="These notes are now out of date!"></p>
<p>Using <a href="http://pandoc.org/" target="_blank" rel="external">pandoc</a>, one can easily convert between many formats, including HTML, docx, LaTeX etc. I may use this to insert parts of my notes into my reports.</p>
<p>There are a huge number of purely online editors, such as <a href="https://stackedit.io/editor" target="_blank" rel="external">Stackedit</a><br>Some of them look very good, but I would not have full control over the files.</p>
<h3 id="Other-things"><a href="#Other-things" class="headerlink" title="Other things"></a>Other things</h3><p>In the last project meeting, Rich asked about how the graphics are drawn to the headset. I didn’t give a clear answer, but here it is:</p>
<ul>
<li>Direct mode: Graphics are drawn directly to the HMD (head-mounted display). Better VR (virtual reality) performance.</li>
<li>Extended mode: HMD display is treated like an additional monitor.</li>
<li>OpenVR: <strong>Proprietary</strong> VR abstraction layer which supports a number of HMDs.</li>
<li>OSVR: <strong>Open source</strong> abstraction layer which supports a number of HMDs (including the Vive).</li>
<li>OpenHMD: Supports some HMDs but not the Vive.</li>
</ul>
<p>(Info found at <a href="http://www.vronlinux.com/articles/adventures-with-openvr-and-the-vive-on-linux.8" target="_blank" rel="external">vronlinux</a>)<br>(<a href="https://www.gamingonlinux.com/articles/first-steps-with-openvr-and-the-vive-on-linux.7229" target="_blank" rel="external">This one</a> is a slightly more up to date version)</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/15/Environment-setup/" data-id="cizlhttae000a509rfxpzmet9" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  
    <article id="post-Reading-around" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Robotic-Telepresence/2016/10/13/Reading-around/">Reading around</a>
    </h1>
  

      </header>
    
  <div class="article-meta">
    <a href="/Robotic-Telepresence/2016/10/13/Reading-around/" class="article-date">
  <time datetime="2016-10-13T16:28:51.000Z" itemprop="datePublished">Thu 13/10/2016 17:28</time>
</a>
    
  </div>
  <div class="article-entry" itemprop="articleBody">
    
      <h3 id="ROS-compatibility"><a href="#ROS-compatibility" class="headerlink" title="ROS compatibility"></a>ROS compatibility</h3><p>The main objective is to interface with ROS.<br>This is only officialy supported from a Linux distribution for now (<a href="http://wiki.ros.org/ROS/Installation" target="_blank" rel="external">Homepage</a>).<br>There is shaky support for <a href="http://wiki.ros.org/win_ros" target="_blank" rel="external">Windows</a>.</p>
<h3 id="Vive-compatibility"><a href="#Vive-compatibility" class="headerlink" title="Vive compatibility"></a>Vive compatibility</h3><p>The Vive is interfaced with SteamVR which is only supported in Windows (through the Steam client).<br>Most personal VR projects I have seen don’t integrate into the Steam client in any way, but it still needs to be open to run the SteamVR daemon.<br>However, the hardware itself is supposed to be quite open soit’s likely that unofficial drivers exist for other operating systems.</p>
<h3 id="Possible-courses-of-action"><a href="#Possible-courses-of-action" class="headerlink" title="Possible courses of action:"></a>Possible courses of action:</h3><h5 id="Run-ROS-under-Windows"><a href="#Run-ROS-under-Windows" class="headerlink" title="Run ROS under Windows"></a>Run ROS under Windows</h5><p>Advantages:<br>The entire project could be run from a single operating system, so only one separate device from the robotics would be required.<br>Most modern game engines are only supported, or have the most compatibility with Windows, so I would be able to take advantage of the environments, tools, code snippets and superior rendering quality.<br>This also applies to graphics card drivers.</p>
<p>Worries:<br>The support for ROS is shaky and as I am inexperienced with it I won’t know to what extent it isn’t working or how to fix things, if even possible.</p>
<h5 id="Run-game-engine-in-Linux"><a href="#Run-game-engine-in-Linux" class="headerlink" title="Run game engine in Linux"></a>Run game engine in Linux</h5><p>Advantages:<br>Again, the entire project could be run from a single device.<br>I wouldn’t have to worry about extra issues with running ROS.<br>Most of my text-based programming experience is in Linux so it’s a familiar environment.</p>
<p>Worries:<br>With a first look, most modern game engine development suites don’t list support for Linux development<br>There may be some alpha builds, but Unreal and Unity don’t list Linux distributions on their downloads pages.</p>
<p>An alternative would be to use raw OpenGL, however this might end up being a lot of extra work on ‘primitive’ functions which are second nature to popular game engines. I would presumably use some custom libraries which I would need to choose and learn to use.<br>This could make the executable slimmer and less dependent on the industry, but I’m not sure how much this matters.</p>
<h5 id="Use-a-combination"><a href="#Use-a-combination" class="headerlink" title="Use a combination"></a>Use a combination</h5><p>Advantages:<br>This would take the best of both worlds, having compatibility with VR, game engines and ROS.<br>I have not done much reading on ROS yet, but it may be possible to have a low-powered networked device like a <em>Raspberry Pi</em> to route communications from the VR headset in a game engine in a ROS-like way to the robotics.</p>
<p>Worries:<br>Having communications between devices in two places is a greater potential for errors.<br>I’m not sure how easy or hard this will be, I think Rich mentioned ROS/Python interoperability.</p>
<p>This seems like the way to go.</p>
<h3 id="Next-steps"><a href="#Next-steps" class="headerlink" title="Next steps:"></a>Next steps:</h3><p>Before I can do anything like a Gantt chart I should probably choose which of these paths to follow.<br>In order to make an informed decision I should do some reading and testing around this area.</p>
<ol>
<li>Do some research on ROS. I hear there are some beginner tutorials so I can work my way through those.<br>I shouldn’t need access to a physical robot to do them.</li>
<li>Look at VR and Unity(/Unreal) support under Linux.<br>These are the two Rich mentioned, and the only (or best) two I know of which support virtual reality.<br>I have used Unity before, and it has been free for personal use for much longer, so I will try this first.</li>
<li>Set up development environments.<br>This involves physical Linux partitions on my PC, and probably Linux virtual machines.<br>I will have to choose a distribution, it will likely be a lightweight flavour of Ubuntu (LTS) (Long-term support).<br>I’ll also need to host my notes in a convenient, secure and easy manner. I’m writing this in a text document, I’ll probably copy them over to the new format once I’ve decided.<br>As I’ll be on multiple machines and operating systems I’m thinking of using Markdown, and hopefully something better than Dropbox/equivalent services.</li>
</ol>
<h3 id="At-some-point"><a href="#At-some-point" class="headerlink" title="At some point"></a>At some point</h3><p>Work out to a greater degree of specificity the direction this project will take.<br>I’ll be using the <insert brand=""> Baxter robot to start off with, but the project is to interface with ROS generally, so could be applied to many types of robot.</insert></p>
<p>Do I use a purely virtual model of Baxter?<br>Do I use a point cloud from the Kinect, mounted above Baxter?<br>Do I do some combination of the two?<br>…or something else?</p>

    
  </div>
  <footer class="article-footer">
    <a data-url="https://celynwalters.github.io/Robotic-Telepresence/Robotic-Telepresence/2016/10/13/Reading-around/" data-id="cizlhttbd0017509roydrepft" class="article-share-link">Share</a>
    
     
  </footer>
  
</article>



  

</section>
        <!-- MANUALLY ADDED FOR GANTT CHART -->
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2017/02/">February 2017</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2016/12/">December 2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2016/11/">November 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/Robotic-Telepresence/archives/2016/10/">October 2016</a><span class="archive-list-count">14</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Celyn Walters<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/Robotic-Telepresence/" class="mobile-nav-link">Home</a>
  
    <a href="/Robotic-Telepresence/Project-objectives" class="mobile-nav-link">Project Objectives</a>
  
    <a href="https://www.teamgantt.com/gantt/schedule/?ids=702976&public_keys=1UNWW0SIdEwg&zoom=w90&font_size=12&estimated_hours=0&assigned_resources=0&percent_complete=0&documents=0&comments=0&col_width=255&menu_view=0&resource_filter=1&name_in_bar=0&name_next_to_bar=0&resource_names=1" class="mobile-nav-link">Gantt Chart</a>
  
    <a href="/Robotic-Telepresence/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/Robotic-Telepresence/fancybox/jquery.fancybox.css">
  <script src="/Robotic-Telepresence/fancybox/jquery.fancybox.pack.js"></script>


<script src="/Robotic-Telepresence/js/script.js"></script>

  </div>
</body>
</html>
